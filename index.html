<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÈáéÂéüÂΩ©È¶ô„ÅÆÁ†îÁ©∂ÊàêÈï∑Ê®π</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Noto Sans JP", "Ê∏∏„Ç¥„Ç∑„ÉÉ„ÇØ", "Yu Gothic", sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc8 30%, #f1f8e9 70%, #e8f5e8 100%);
            min-height: 100vh;
            color: #2e5233;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(76, 175, 80, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 195, 74, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .main-title {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .main-title h1 {
            font-size: 2.8em;
            color: #1b5e20;
            font-weight: 600;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(76, 175, 80, 0.1);
        }

        .subtitle {
            font-size: 1.2em;
            color: #4a7c59;
            font-weight: 300;
            font-style: italic;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 2px solid #c8e6c9;
            overflow-x: auto;
            position: relative;
        }

        .tree-svg {
            width: 100%;
            height: 1000px;
            min-width: 1200px;
            cursor: move;
        }

        .node {
            cursor: pointer;
        }

        .node-circle {
            transition: all 0.3s ease;
        }

        .node:hover .node-circle {
            stroke-width: 4;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .node-text {
            font-family: "Noto Sans JP", sans-serif;
            pointer-events: none;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.8));
        }

        .link {
            fill: none;
            stroke: #5d4037;
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke: #4a2c2a;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .link.has-papers {
            stroke: #8d6e63;
        }

        .paper-indicator {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .paper-indicator:hover {
            transform: scale(1.2);
        }

        .paper-tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 255, 248, 0.95));
            border: 2px solid #8bc34a;
            border-radius: 15px;
            padding: 20px;
            font-size: 0.85em;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1001;
            max-width: 500px;
            min-width: 300px;
            max-height: 600px;
            overflow-y: auto;
        }

        .paper-tooltip.visible {
            opacity: 1;
        }

        .paper-tooltip h4 {
            color: #1b5e20;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid #c8e6c9;
            padding-bottom: 8px;
        }

        .paper-item {
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(139, 195, 74, 0.1);
            border-radius: 8px;
            border-left: 3px solid #66bb6a;
        }

        .paper-title {
            font-weight: 600;
            color: #2e5233;
            margin-bottom: 4px;
            line-height: 1.3;
            font-size: 0.9em;
        }

        .paper-meta {
            color: #4a7c59;
            font-size: 0.85em;
            font-style: italic;
        }

        .paper-count {
            background: #66bb6a;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.9em;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #a5d6a7;
        }

        .info-section h3 {
            color: #1b5e20;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .collaboration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .collaboration-item {
            background: linear-gradient(135deg, rgba(139, 195, 74, 0.1), rgba(165, 214, 167, 0.1));
            border: 1px solid rgba(129, 199, 132, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .collaboration-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(129, 199, 132, 0.2);
        }

        .timeline-items {
            display: grid;
            gap: 15px;
        }

        .timeline-item {
            background: linear-gradient(135deg, rgba(102, 187, 106, 0.1), rgba(129, 199, 132, 0.1));
            border: 1px solid rgba(139, 195, 74, 0.3);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #66bb6a;
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(139, 195, 74, 0.2);
        }

        .year {
            font-weight: 600;
            color: #2e5233;
            font-size: 1.1em;
        }

        .chart-note {
            text-align: center;
            color: #4a7c59;
            font-style: italic;
            margin-top: 20px;
            padding: 15px;
            background: rgba(139, 195, 74, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(139, 195, 74, 0.2);
        }

        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #c8e6c9;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 0.85em;
            z-index: 10;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.8em;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #c8e6c9;
            border-radius: 10px;
            padding: 10px;
            font-size: 0.85em;
            z-index: 10;
        }

        .controls button {
            background: #66bb6a;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .controls button:hover {
            background: #4caf50;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .main-title h1 {
                font-size: 2.2em;
            }
            
            .tree-svg {
                height: 700px;
            }
            
            .main-title {
                padding: 20px;
            }
            
            .chart-container {
                padding: 20px;
            }
            
            .legend {
                position: static;
                margin-bottom: 20px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-title">
            <h1>üå≥ Â∞èÈáéÂéüÂΩ©È¶ô„ÅÆÁ†îÁ©∂ÊàêÈï∑Ê®π</h1>
            <div class="subtitle">Ê†π„Åã„ÇâÂππ„ÄÅÊûù„ÇíÁµå„Å¶Ëëâ„Å∏„Å®ÊàêÈï∑„Åô„ÇãÁ†îÁ©∂„ÅÆÁ≥ªÁµ±Áô∫Áîü - ÂäõÂ≠¶ÁöÑÈÖçÁΩÆ„Å´„Çà„ÇäËá™ÁÑ∂„Å´Â∫É„Åå„ÇãÁü•Ë≠ò„ÅÆÊ®π</div>
        </div>
        
        <div class="chart-container">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-circle" style="background: #6d4c41;"></div>
                    <span>Ê†π„Å£„ÅìÔºöÁ†îÁ©∂ËÄÖ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #8d6e63;"></div>
                    <span>ÂππÔºö‰∏ªË¶ÅÁ†îÁ©∂ÂàÜÈáé</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #66bb6a;"></div>
                    <span>ÊûùÔºöË©≥Á¥∞Á†îÁ©∂È†òÂüü</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #ff6b6b;"></div>
                    <span>ËëâÔºöË´ñÊñáÔºàÂπ¥Ë°®Á§∫Ôºâ</span>
                </div>
            </div>
            <div class="controls">
                <button id="restart-simulation">ÈÖçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà</button>
                <button id="freeze-simulation">ÈÖçÁΩÆ„ÇíÂõ∫ÂÆö</button>
            </div>
            <svg class="tree-svg" id="tree-chart"></svg>
            <div class="chart-note">
                üå≥ ÂäõÂ≠¶ÁöÑÈÖçÁΩÆ„Å´„Çà„ÇäËá™ÁÑ∂„Å´Â∫É„Åå„ÇãÁ†îÁ©∂Á≥ªÁµ±Ê®π<br>
                üîç „Éé„Éº„Éâ„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶ÈÖçÁΩÆ„ÇíË™øÊï¥„Åß„Åç„Åæ„Åô„ÄÇÂêÑË¶ÅÁ¥†„Çí„Éõ„Éê„Éº„Åó„Å¶Ë©≥Á¥∞„Çí„ÅîË¶ß„Åè„Å†„Åï„ÅÑ
            </div>
        </div>

        <div class="info-section">
            <h3>üìÖ Á†îÁ©∂Áô∫Â±ï„ÅÆÊôÇÁ≥ªÂàó</h3>
            <div class="timeline-items">
                <div class="timeline-item">
                    <span class="year">2024Âπ¥:</span> ÂØæË©±ÂûãAI„É¢„Éá„É´„Å®Èü≥Â£∞ÊäÄË°ì„ÅÆÊïôËÇ≤ÂøúÁî®
                </div>
                <div class="timeline-item">
                    <span class="year">2023Âπ¥:</span> „Éô„Ç§„Ç∏„Ç¢„É≥Á≥ªÁµ±Áô∫ÁîüËß£ÊûêË´ñÊñá (Journal of Language Evolution)
                </div>
                <div class="timeline-item">
                    <span class="year">2022Âπ¥:</span> ÈÄ≤ÂåñÁöÑ„Ç¢„Éó„É≠„Éº„ÉÅ„Å´„Çà„Çã„Ç¢„ÇØ„Çª„É≥„ÉàÊ©üËÉΩÁ†îÁ©∂ÈñãÂßã
                </div>
                <div class="timeline-item">
                    <span class="year">2018-2023Âπ¥:</span> ÈõÜÂõ£ÊßãÈÄ†„ÇíËÄÉÊÖÆ„Åó„ÅüË®ÄË™ûÂ§âÂåñ„Éó„É≠„Çª„ÇπÁ†îÁ©∂
                </div>
                <div class="timeline-item">
                    <span class="year">2016-2019Âπ¥:</span> Ë®ÄË™ûÂ§âÂåñË¶ÅÂõ†„Å®Á≥ªË≠ú„ÅÆÂÆöÈáèÁöÑË©ï‰æ°Á†îÁ©∂
                </div>
                <div class="timeline-item">
                    <span class="year">2013-2017Âπ¥:</span> Êï∞ÁêÜÁöÑ„Ç¢„Éó„É≠„Éº„ÉÅ„Å´„Çà„ÇãË®ÄË™ûÂãïÊÖãÁ†îÁ©∂ÔºàÂçöÂ£´Á†îÁ©∂Ôºâ
                </div>
                <div class="timeline-item">
                    <span class="year">2010-2013Âπ¥:</span> ÊñπË®ÄÂàÜÂ∏É„ÉªÊñáÂåñÈ†òÂüüÂàÜÊûê„ÅÆÂü∫Á§éÁ†îÁ©∂
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>
    <div class="paper-tooltip" id="paper-tooltip"></div>

    <script>
        // Á†îÁ©∂„Éá„Éº„ÇøÔºàË´ñÊñáÊÉÖÂ†±‰ªò„ÅçÔºâ- Ë´ñÊñá„ÇíÁ¨¨4ÈöéÂ±§„Å®„Åó„Å¶ËøΩÂä† 
        const treeData = {
            name: 'Â∞èÈáéÂéüÂΩ©È¶ô',
            description: 'Ë®ÄË™ûÂ≠¶„ÉªÊñáÂåñÈÄ≤Âåñ„Éª„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„ÇπÁ†îÁ©∂ËÄÖ',
            level: 0,
            children: [
                {
                    name: 'Ë®ÄË™ûÈÄ≤ÂåñÁ†îÁ©∂',
                    description: '„Éô„Ç§„Ç∏„Ç¢„É≥Á≥ªÁµ±Áô∫ÁîüËß£Êûê„Éª„Ç¢„ÇØ„Çª„É≥„ÉàÁ†îÁ©∂',
                    level: 1,
                    children: [
                        { 
                            name: '„Ç¢„ÇØ„Çª„É≥„ÉàÁ≥ªÁµ±Áô∫ÁîüÂ≠¶', 
                            description: '„Éô„Ç§„Ç∏„Ç¢„É≥Á≥ªÁµ±Áô∫ÁîüËß£Êûê„Å´„Çà„Çã„Éî„ÉÉ„ÉÅ„Ç¢„ÇØ„Çª„É≥„Éà„Ç∑„Çπ„ÉÜ„É†', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Bayesian phylogenetic analysis of pitch-accent systems based on accentual class merger: a new method applied to Japanese dialects',
                                    journal: 'Journal of Language Evolution',
                                    year: '2024',
                                    details: '8(2) 169-191, ÊüªË™≠Êúâ„Çä'
                                },
                                {
                                    title: 'Inferring the temporal and spatial evolution of accent systems in Japanese dialects: a phylogeographic approach',
                                    journal: 'Proceedings of the Joint Conference on Language Evolution',
                                    year: '2022',
                                    details: 'ÊüªË™≠Êúâ„Çä'
                                }
                            ]
                        },
                        { 
                            name: 'ÊñπË®Ä„ÅÆÊôÇÁ©∫ÈñìÂ§âÁï∞', 
                            description: 'Êó•Êú¨Ë™ûÊñπË®Ä„ÅÆ„Ç¢„ÇØ„Çª„É≥„Éà„Ç∑„Çπ„ÉÜ„É†„ÅÆÊôÇÁ©∫ÈñìÈÄ≤Âåñ', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Ë®ÄË™û„ÅÆÊ∂àÂ§±„Å®Áç≤Âæó„Å´Èñ¢ÈÄ£„Åô„ÇãÁí∞Â¢É„ÉªÁ§æ‰ºöÁöÑË¶ÅÂõ†',
                                    journal: 'GISÔºçÁêÜË´ñ„Å®ÂøúÁî®',
                                    year: '2016',
                                    details: '24(2), ÊãõÂæÖÊúâ„Çä'
                                },
                                {
                                    title: 'Êó•Êú¨Ë™ûÊñπË®Ä„ÅÆÊé®ÂÆö„Åï„Çå„Åü„Ç¢„ÇØ„Çª„É≥„ÉàÈ°ûÂà•„ÅÆ‰ΩµÂêàÁéá„ÅÆÁ≥ªÁµ±Âú∞ÁêÜ',
                                    journal: 'GISÔºçÁêÜË´ñ„Å®ÂøúÁî®',
                                    year: '2016',
                                    details: '24(2), ÊãõÂæÖÊúâ„Çä'
                                },
                                {
                                    title: '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰∏ä„ÅÆÊñáÂåñ‰ºùÈÅî„É¢„Éá„É´„Å´„Çà„ÇãÊó•Êú¨Ë™û„Ç¢„ÇØ„Çª„É≥„ÉàÊßòÂºè„ÅÆÂ§âÁï∞Áéá„ÉªÁ≥ªÁµ±Èñ¢‰øÇ„ÅÆÊé®ÂÆö',
                                    journal: 'ÂõΩÁ´ãÂõΩË™ûÁ†îÁ©∂ÊâÄ ÊôÇÁ©∫ÈñìÂ§âÁï∞Á†îÁ©∂Á≥ª ÂêàÂêåÁ†îÁ©∂Áô∫Ë°®‰ºö JLVC2012 ‰∫àÁ®øÈõÜ',
                                    year: '2012',
                                    details: '43-46, ÊüªË™≠Êúâ„Çä'
                                }
                            ]
                        },
                        { 
                            name: 'Ë®ÄË™ûÂ§âÂåñ„É¢„Éá„É´', 
                            description: 'Êï∞ÁêÜÁöÑ„Ç¢„Éó„É≠„Éº„ÉÅ„Å´„Çà„ÇãË®ÄË™ûÂãïÊÖã', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Êï∞ÁêÜÁöÑ„Ç¢„Éó„É≠„Éº„ÉÅ„Åã„Çâ„ÅÆË®ÄË™ûÂ§âÂåñ„Å®Â§ñË®ÄË™ûÁöÑË¶ÅÁ¥†„Å®„ÅÆÈñ¢„Çè„Çä„Å´Èñ¢„Åô„ÇãÁ†îÁ©∂',
                                    journal: '',
                                    year: '2014',
                                    details: 'ÊüªË™≠Êúâ„ÇäÁ≠ÜÈ†≠ËëóËÄÖ'
                                },
                                {
                                    title: '‰∫§ÈÄöÁ≥ªÁµ±Ë®àÊÉÖÂ†±„ÅÆÂàÜÂ∏É„Å®Ë®ÄË™ûÂ§ñÁöÑË¶ÅÁ¥†„Å´Èñ¢„Åô„ÇãÁ†îÁ©∂',
                                    journal: 'ÊÉÖÂ†±Âá¶ÁêÜÂ≠¶‰ºö„Ç∑„É≥„Éù„Ç∏„Ç¶„É†Ë´ñÊñáÈõÜ',
                                    year: '2010',
                                    details: '2010(15) 239-246, ÊüªË™≠Êúâ„Çä'
                                }
                            ]
                        }
                    ]
                },
                {
                    name: 'ÊñáÂåñÈÄ≤ÂåñÁêÜË´ñ',
                    description: 'ÊñáÂåñ‰ºùÈÅî„É¢„Éá„É´„ÉªÂÆöÈáèÂàÜÊûê',
                    level: 1,
                    children: [
                        { 
                            name: 'ÊñáÂåñÂ§öÊßòÊÄßÊ©üÊßã', 
                            description: 'ÊñáÂåñÁöÑÂ§öÊßòÊÄß„ÅÆÈÄ≤Âåñ„É°„Ç´„Éã„Ç∫„É†', 
                            level: 2,
                            papers: [
                                {
                                    title: 'ÈõëË™å„ÄåË°åÂãïË®àÈáèÂ≠¶„Äç„Å´„Åä„Åë„ÇãË®ÄË™û„Å´Èñ¢„Åô„ÇãÊäïÁ®øË´ñÊñá„ÅÆÂÇæÂêë',
                                    journal: 'Êó•Êú¨Ë°åÂãïË®àÈáèÂ≠¶‰ºöÂ§ß‰ºöÁô∫Ë°®Ë´ñÊñáÊäÑÈå≤ÈõÜ',
                                    year: '2012',
                                    details: '40 415-418'
                                }
                            ]
                        },
                        { 
                            name: 'ÊñáÂåñ‰ºùÈÅî„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ', 
                            description: '„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰∏ä„ÅÆÊñáÂåñ‰ºùÈÅî„É¢„Éá„É´', 
                            level: 2,
                            papers: [
                                {
                                    title: 'ITMA„Å´„Åä„Åë„ÇãNCD„ÅÆÂÆüÁî®ÊÄß„Å®UML„ÇíÁî®„ÅÑ„ÅüÂàÜÊûê„Éó„É≠„Çª„Çπ„ÅÆÂèØË¶ñÂåñ„Å®ÂÖ±Êúâ„Å´„Å§„ÅÑ„Å¶',
                                    journal: 'ÊÉÖÂ†±Âá¶ÁêÜÂ≠¶‰ºö„Ç∑„É≥„Éù„Ç∏„Ç¶„É†Ë´ñÊñáÈõÜ',
                                    year: '2010',
                                    details: '2010(15) 239-246, ÊüªË™≠Êúâ„Çä'
                                },
                                {
                                    title: 'Â≤êÈòúÁúåÊóßÂæ≥Â±±Êùë„Å´„Åä„Åë„Çã„Ç¢„ÇØ„Çª„É≥„ÉàÊßòÁõ∏„Å®‰∫§ÈÄöÁä∂Ê≥Å„Å®„ÅÆÈñ¢‰øÇÊÄß-„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÂàÜÊûê„ÇíÁî®„ÅÑ„Åü„Ç¢„ÇØ„Çª„É≥„ÉàÂàÜÂ∏É„Å®‰∫§ÈÄöÁä∂Ê≥Å„ÅÆÈ°û‰ººÊÄß„ÅÆÁÆóÂá∫-',
                                    journal: 'ÊÉÖÂ†±Âá¶ÁêÜÂ≠¶‰ºö„Ç∑„É≥„Éù„Ç∏„Ç¶„É†Ë´ñÊñáÈõÜ',
                                    year: '2011',
                                    details: '2011(8) 219-224, ÊüªË™≠Êúâ„ÇäÁ≠ÜÈ†≠ËëóËÄÖ'
                                }
                            ]
                        },
                        { 
                            name: 'ÂÆöÈáèÁöÑÊñπË®ÄÂ≠¶', 
                            description: 'Â≤êÈòúÁúåÊñπË®ÄË™ûÂΩô„Å´„Çà„ÇãÊñáÂåñÈ†òÂüüÊäΩÂá∫', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Â≤êÈòúÁúåÊñπË®ÄË™ûÂΩô„Å´„Çà„Çã‰ªÆÊÉ≥ÁöÑÊñáÂåñÈ†òÂüüÊäΩÂá∫„Å®Ë™ûÂΩôÂ§âÂåñ„ÅÆÊñπÂêë',
                                    journal: 'Á†îÁ©∂Â†±Âëä‰∫∫ÊñáÁßëÂ≠¶„Å®„Ç≥„É≥„Éî„É•„Éº„ÇøÔºàCHÔºâ',
                                    year: '2012',
                                    details: '2012(4) 1-6, Á≠ÜÈ†≠ËëóËÄÖ'
                                },
                                {
                                    title: 'ÊèñÊñêÂ∑ù‰∏äÊµÅÂüü„Å´„Åä„Åë„ÇãË™ûÂΩô„ÅÆÈ°ûÂûã„Å®Âú∞ÁêÜÁöÑÂàÜÂ∏É',
                                    journal: 'ÊñáÂåñÊÉÖÂ†±Â≠¶',
                                    year: '2012',
                                    details: '8(1) 1-11, ÊüªË™≠Êúâ„ÇäÁ≠ÜÈ†≠ËëóËÄÖ'
                                },
                                {
                                    title: 'ÊèñÊñêÂ∑ù‰∏äÊµÅÂüü„ÅÆË™ûÂΩô„Å´Èñ¢„Åô„ÇãÁ≥ªÁµ±Êé®ÂÆö',
                                    journal: 'Á†îÁ©∂Â†±Âëä‰∫∫ÊñáÁßëÂ≠¶„Å®„Ç≥„É≥„Éî„É•„Éº„ÇøÔºàCHÔºâ',
                                    year: '2012',
                                    details: '2012(4) 1-6'
                                }
                            ]
                        }
                    ]
                },
                {
                    name: 'GIS„ÉªÁ©∫ÈñìÂàÜÊûê',
                    description: 'Âú∞ÁêÜÊÉÖÂ†±„Ç∑„Çπ„ÉÜ„É†„ÉªÊ©üÊ¢∞Â≠¶ÁøíÂøúÁî®',
                    level: 1,
                    children: [
                        { 
                            name: '„ÉØ„Ç§„É≥Ê†ΩÂüπÈÅ©Âú∞', 
                            description: 'Ê©üÊ¢∞Â≠¶Áøí„ÇíÁî®„ÅÑ„Åü„ÉØ„Ç§„É≥Áî®„Éñ„Éâ„Ç¶Ê†ΩÂüπÈÅ©Âú∞Êé®ÂÆö', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Ê©üÊ¢∞Â≠¶Áøí„ÇíÁî®„ÅÑ„Åü„ÉØ„Ç§„É≥Áî®„Éñ„Éâ„Ç¶Ê†ΩÂüπÈÅ©Âú∞„ÅÆÊé®ÂÆö',
                                    journal: 'GIS-ÁêÜË´ñ„Å®ÂøúÁî®',
                                    year: '2023',
                                    details: '31(2) 78-78, ÊãõÂæÖÊúâ„Çä'
                                },
                                {
                                    title: 'CLIENT-SIDE WEB MAPPING SYSTEM FOR VINEYARD SUITABILITY ASSESSMENT',
                                    journal: 'The International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences',
                                    year: '2022',
                                    details: 'XLVIII-4/W1-2022 223-228, ÊüªË™≠Êúâ„Çä'
                                }
                            ]
                        },
                        { 
                            name: 'Á©∫ÈñìË®ÄË™ûÂ≠¶', 
                            description: 'Ë®ÄË™ûÂ§âÂåñ„ÅÆÂú∞ÁêÜÁöÑ„Éë„Çø„Éº„É≥', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Ë®ÄË™û„ÅÆÊ∂àÂ§±„Å®Áç≤Âæó„Å´Èñ¢ÈÄ£„Åô„ÇãÁí∞Â¢É„ÉªÁ§æ‰ºöÁöÑË¶ÅÂõ†',
                                    journal: 'Âú∞ÁêÜÊÉÖÂ†±„Ç∑„Çπ„ÉÜ„É†Â≠¶‰ºöË¨õÊºîË´ñÊñáÈõÜ(CD-ROM)',
                                    year: '2016',
                                    details: '25 40-40, Á≠ÜÈ†≠ËëóËÄÖË≤¨‰ªªËëóËÄÖ'
                                },
                                {
                                    title: 'ÊñπË®ÄÂàÜÂ∏É„Åã„ÇâË¶ã„ÅüÊñáÂåñ‰∫ãË±°„ÅÆÊµÅÈÄö„Å®ÊªûÁïô‚ÄïÂ≤êÈòúÁúå„Å´„Åä„Åë„ÇãÊñπË®ÄÂàÜÂ∏É„ÅÆ‰∫ã‰æã‚Äï',
                                    journal: 'Âú∞ÁêÜÊÉÖÂ†±„Ç∑„Çπ„ÉÜ„É†Â≠¶‰ºöË¨õÊºîË´ñÊñáÈõÜ(CD-ROM)',
                                    year: '2010',
                                    details: '19, 473-480'
                                }
                            ]
                        },
                        { 
                            name: 'ÊñáÂåñÂú∞ÁêÜÂ≠¶', 
                            description: 'ÊñáÂåñ‰∫ãË±°„ÅÆÊµÅÈÄö„Å®ÊªûÁïôÂàÜÊûê', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Classification of land use/cover change in the Kanto region, Japan using FOSS4G and Open Data',
                                    journal: 'Free and Open Source Software for Geospatial (FOSS4G) Conference Proceedings',
                                    year: '2016',
                                    details: '13(16), ÊüªË™≠Êúâ„Çä'
                                },
                                {
                                    title: 'ÊñáÂåñÁöÑÊÉÖÂ†±„ÅÆÊµÅÈÄöË∑Ø„Å®„Åù„ÅÆÊªûÁïô‚ÄïÂ≤êÈòúÁúå„Çí‰æã„Å®„Åó„ÅüÊñπË®ÄÂàÜÂ∏É„ÅÆË¶≥ÁÇπ„Åã„Çâ‚Äï',
                                    journal: 'Â≠¶Áîü„ÉªËã•Êâã Âú∞ÁêÜÁ©∫ÈñìÊÉÖÂ†±„Éï„Ç©„Éº„É©„É† in Èñ¢Ë•ø Ë´ñÊñáÈõÜ',
                                    year: '2010',
                                    details: '51-58, Á≠ÜÈ†≠ËëóËÄÖ'
                                },
                                {
                                    title: 'ÊñπË®ÄÂàÜÂ∏É„Éá„Éº„Çø„ÅÆÊï∞ÁêÜÁöÑÂàÜÊûê(ÁâπÂà•„Çª„ÉÉ„Ç∑„Éß„É≥ ÊñπË®ÄÂàÜÂ∏É„Å®Ë®àÈáè(2))',
                                    journal: 'Êó•Êú¨Ë°åÂãïË®àÈáèÂ≠¶‰ºöÂ§ß‰ºöÁô∫Ë°®Ë´ñÊñáÊäÑÈå≤ÈõÜ',
                                    year: '2012',
                                    details: '40, 415-418'
                                }
                            ]
                        }
                    ]
                },
                {
                    name: 'AI„ÉªÊïôËÇ≤ÊäÄË°ì',
                    description: '„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„ÇπÊïôËÇ≤„ÉªAIÂøúÁî®',
                    level: 1,
                    children: [
                        { 
                            name: 'AIÊïôËÇ≤„Ç≥„É≥„ÉÜ„É≥„ÉÑ', 
                            description: 'ÂØæË©±ÂûãAI„É¢„Éá„É´„ÅÆÊïôËÇ≤ÂøúÁî®', 
                            level: 2,
                            papers: [
                                {
                                    title: 'ÂØæË©±ÂûãAI„É¢„Éá„É´‰∏¶„Å≥„Å´AIÈü≥Â£∞„ÇíÊ¥ªÁî®„Åó„ÅüÊïôËÇ≤„Ç≥„É≥„ÉÜ„É≥„ÉÑ‰ΩúÊàê ‚ÄïAIÊäÄË°ì„ÅÆÊñ∞„Åü„Å™Â±ïÈñã‚Äï',
                                    journal: 'Á§æ‰ºö„Å®Áµ±Ë®à',
                                    year: '2024',
                                    details: '(10) 27-44'
                                }
                            ]
                        },
                        { 
                            name: '„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„ÇπÊïôËÇ≤', 
                            description: 'Áµ±Ë®àÊïôËÇ≤„ÅÆË≥™‰øùË®ºÁ†îÁ©∂', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Áµ±Ë®àÊïôËÇ≤„Å´Èñ¢„Åô„ÇãÊéàÊ•≠ÂÜÖÂÆπ„ÅÆÂÇæÂêë„Å®Â≠¶Áîü„ÅÆÊéàÊ•≠Ë©ï‰æ°ÔºöÁµ±Ë®àÊïôËÇ≤Ë≥™‰øùË®º„Å´Èñ¢„Åô„ÇãÂàÜÊûêË™øÊüª',
                                    journal: 'ÊñáÂåñÊÉÖÂ†±Â≠¶',
                                    year: '2013',
                                    details: '9(1) 1-11, ÊüªË™≠Êúâ„Çä'
                                },
                                {
                                    title: 'ÈÄ£Êê∫Ê†°Â≠¶ÈÉ®„Ç∑„É©„Éê„Çπ„ÅÆÂÖ®ÂÆπ„Å®ÂêåÂøóÁ§æÂ§ßÂ≠¶ÊñáÂåñÊÉÖÂ†±Â≠¶ÈÉ®„Äå„Éá„Éº„Çø„Çµ„Ç§„Ç®„É≥„ÇπÁßëÁõÆ„Äç„ÅÆ„Ç¢„É≥„Ç±„Éº„ÉàË™øÊüª',
                                    journal: 'ÊñáÂåñÊÉÖÂ†±Â≠¶',
                                    year: '2012',
                                    details: '8(1) 1-11, ÊüªË™≠Êúâ„ÇäÁ≠ÜÈ†≠ËëóËÄÖ'
                                }
                            ]
                        },
                        { 
                            name: 'Python GISÊïôÊùê', 
                            description: 'PythonÂú∞ÁêÜÁ∑èÂêàÂÆüÁøí„Ç≥„É≥„ÉÜ„É≥„ÉÑ', 
                            level: 2,
                            papers: [
                                {
                                    title: 'Python „ÇíÂà©Áî®„Åó„ÅüÂú∞ÁêÜÁ∑èÂêàÂÆüÁøí„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ‰ΩúÊàê',
                                    journal: 'Êó•Êú¨Âú∞ÁêÜÂ≠¶‰ºöÁô∫Ë°®Ë¶ÅÊó®ÈõÜ',
                                    year: '2023',
                                    details: '2023s. P007'
                                },
                                {
                                    title: 'ÊñπË®ÄÂàÜÂ∏É„Åã„ÇâË¶ã„ÅüÊñáÂåñ‰∫ãË±°„ÅÆÊµÅÈÄö„Å®ÊªûÁïô‚ÄïÂ≤êÈòúÁúå„Å´„Åä„Åë„ÇãÊñπË®ÄÂàÜÂ∏É„ÅÆ‰∫ã‰æã‚Äï',
                                    journal: 'ÊÉÖÂ†±Âá¶ÁêÜÂ≠¶‰ºö„Ç∑„É≥„Éù„Ç∏„Ç¶„É†Ë´ñÊñáÈõÜ',
                                    year: '2011',
                                    details: '2011(8) 219-224, ÊüªË™≠Êúâ„ÇäÁ≠ÜÈ†≠ËëóËÄÖ'
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        class TreeChart {
            constructor(svgId, data) {
                this.svgElement = document.getElementById(svgId);
                this.data = data;
                this.tooltip = document.getElementById('tooltip');
                this.paperTooltip = document.getElementById('paper-tooltip');
                this.width = 1200;
                this.height = 1000;
                this.nodeRadius = { 0: 30, 1: 20, 2: 15, 3: 8 };
                this.fontSize = { 0: '16px', 1: '12px', 2: '10px', 3: '8px' };
                this.init();
            }

            init() {
                // D3.js„ÅßSVG„ÇíË®≠ÂÆö
                this.svg = d3.select(this.svgElement)
                    .attr('viewBox', `0 0 ${this.width} ${this.height}`);
                
                // ËÉåÊôØ„ÅÆ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÂÆöÁæ©
                const defs = this.svg.append('defs');
                const gradient = defs.append('radialGradient')
                    .attr('id', 'treeGradient')
                    .attr('cx', '50%')
                    .attr('cy', '100%')
                    .attr('r', '100%');
                
                gradient.append('stop')
                    .attr('offset', '0%')
                    .attr('stop-color', '#8d6e63')
                    .attr('stop-opacity', 0.1);
                
                gradient.append('stop')
                    .attr('offset', '100%')
                    .attr('stop-color', '#66bb6a')
                    .attr('stop-opacity', 0.05);
                
                // ËÉåÊôØ„ÇíËøΩÂä†
                this.svg.append('rect')
                    .attr('width', this.width)
                    .attr('height', this.height)
                    .attr('fill', 'url(#treeGradient)');
                
                this.processData();
                this.createForceSimulation();
                this.setupControls();
            }

            processData() {
                const nodes = [];
                const links = [];
                let nodeId = 0;
                const height = this.height;
                const width = this.width;
                
                // „É´„Éº„Éà„Éé„Éº„Éâ
                const root = {
                    id: nodeId++,
                    name: this.data.name,
                    description: this.data.description,
                    level: 0,
                    x: width / 2,
                    y: height - 100,
                    fx: width / 2,  // Âõ∫ÂÆöXÂ∫ßÊ®ô
                    fy: height - 100  // Âõ∫ÂÆöYÂ∫ßÊ®ôÔºà‰∏ãÈÉ®Ôºâ
                };
                nodes.push(root);

                // ÂÜçÂ∏∞ÁöÑ„Å´„Éé„Éº„Éâ„Å®„É™„É≥„ÇØ„Çí‰ΩúÊàê
                const processChildren = (parent, children, level) => {
                    if (!children) return;
                    
                    children.forEach((child, i) => {
                        const node = {
                            id: nodeId++,
                            name: child.name,
                            description: child.description,
                            level: level,
                            papers: child.papers || []
                        };
                        
                        // „É¨„Éô„É´„Å´Âøú„Åò„Å¶ÂàùÊúüÂ∫ßÊ®ô„ÇíË®≠ÂÆö
                        if (level === 1) {
                            node.x = width / 2;
                            node.y = height - 250;
                        } else if (level === 2) {
                            node.x = width / 2;
                            node.y = height - 500;
                        } else {
                            node.x = width / 2;
                            node.y = height - 750;
                        }
                        
                        nodes.push(node);
                        
                        // „É™„É≥„ÇØ„Çí‰ΩúÊàêÔºàÁ¨¨3ÈöéÂ±§„Å∏„ÅÆÈÅ∑Áßª„ÅÆÂ†¥Âêà„ÅÆ„Åøpapers„ÇíÂê´„ÇÅ„ÇãÔºâ
                        if (parent.level === 1 && child.papers && child.papers.length > 0) {
                            links.push({ source: parent.id, target: node.id, papers: child.papers });
                        } else {
                            links.push({ source: parent.id, target: node.id });
                        }
                        
                        // Â≠ê„Éé„Éº„Éâ„ÇíÂá¶ÁêÜ
                        if (child.children) {
                            processChildren(node, child.children, level + 1);
                        }
                        
                        // Ë´ñÊñá„Éé„Éº„Éâ„ÇíËøΩÂä†ÔºàÁ¨¨4ÈöéÂ±§Ôºâ
                        if (child.papers && child.papers.length > 0 && level === 2) {
                            const maxPapers = 5;
                            const papersToShow = Math.min(child.papers.length, maxPapers);
                            
                            child.papers.slice(0, papersToShow).forEach((paper, k) => {
                                const paperNode = {
                                    id: nodeId++,
                                    name: paper.year,
                                    description: paper.title,
                                    level: 3,
                                    paper: paper,
                                    x: node.x || width / 2,  // Ë¶™„Éé„Éº„Éâ„ÅÆXÂ∫ßÊ®ô„Çí‰ΩøÁî®
                                    y: height - 750  // Ë´ñÊñá„ÅØÊúÄ‰∏äÈÉ®
                                };
                                nodes.push(paperNode);
                                links.push({ source: node.id, target: paperNode.id });
                            });
                            
                            // ËøΩÂä†„ÅÆË´ñÊñá„Éé„Éº„Éâ
                            if (child.papers.length > maxPapers) {
                                const moreNode = {
                                    id: nodeId++,
                                    name: `+${child.papers.length - maxPapers}`,
                                    description: `‰ªñ${child.papers.length - maxPapers}‰ª∂„ÅÆË´ñÊñá`,
                                    level: 3,
                                    morePapers: child.papers.slice(maxPapers),
                                    x: node.x || width / 2,  // Ë¶™„Éé„Éº„Éâ„ÅÆXÂ∫ßÊ®ô„Çí‰ΩøÁî®
                                    y: height - 750
                                };
                                nodes.push(moreNode);
                                links.push({ source: node.id, target: moreNode.id });
                            }
                        }
                    });
                };

                processChildren(root, this.data.children, 1);
                
                this.nodes = nodes;
                this.links = links;
                
                // „Éá„Éê„ÉÉ„Ç∞Áî®Ôºö„Éé„Éº„Éâ„Å®„É™„É≥„ÇØ„ÅÆÊï∞„ÇíÁ¢∫Ë™ç
                console.log('Total nodes:', this.nodes.length);
                console.log('Total links:', this.links.length);
            }

            createForceSimulation() {
                // „Éé„Éº„ÉâID„Å®„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆ„Éû„ÉÉ„Éó„Çí‰ΩúÊàê
                this.nodeMap = {};
                this.nodes.forEach((node, i) => {
                    this.nodeMap[node.id] = i;
                });
                
                // ÂäõÂ≠¶„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Çí‰ΩúÊàê
                this.simulation = d3.forceSimulation(this.nodes)
                    .force('link', d3.forceLink(this.links)
                        .id(d => d.id)
                        .distance(d => {
                            // „É¨„Éô„É´„Å´Âøú„Åò„Å¶„É™„É≥„ÇØ„ÅÆÈï∑„Åï„ÇíË™øÊï¥
                            const sourceNode = typeof d.source === 'object' ? d.source : this.nodes.find(n => n.id === d.source);
                            const targetNode = typeof d.target === 'object' ? d.target : this.nodes.find(n => n.id === d.target);
                            if (!sourceNode || !targetNode) return 100;
                            
                            if (sourceNode.level === 0) return 200;
                            if (sourceNode.level === 1) return 180;
                            if (sourceNode.level === 2) return 120;
                            return 80;
                        })
                        .strength(0.8))
                    .force('charge', d3.forceManyBody()
                        .strength(d => {
                            // „É¨„Éô„É´„Å´Âøú„Åò„Å¶ÂèçÁô∫Âäõ„ÇíË™øÊï¥
                            if (d.level === 0) return -2000;
                            if (d.level === 1) return -1500;
                            if (d.level === 2) return -1000;
                            return -600;
                        }))
                    .force('x', d3.forceX(d => {
                        // „É¨„Éô„É´„Åî„Å®„Å´Áï∞„Å™„ÇãXÊñπÂêë„ÅÆ‰∏≠ÂøÉ„ÇíË®≠ÂÆö
                        return this.width / 2;
                    }).strength(0.02))
                    .force('y', d3.forceY(d => {
                        // YÊñπÂêë„ÅÆÂäõ„ÇíË™øÊï¥„Åó„Å¶ÈöéÂ±§ÊßãÈÄ†„ÇíÁ∂≠ÊåÅ
                        if (d.level === 0) return this.height - 100;
                        if (d.level === 1) return this.height - 250;
                        if (d.level === 2) return this.height - 500;
                        return this.height - 750;
                    }).strength(0.5))
                    .force('collision', d3.forceCollide()
                        .radius(d => this.nodeRadius[d.level] + 20));

                // „É™„É≥„ÇØ„ÇíÊèèÁîª
                const linkGroup = this.svg.append('g').attr('class', 'links');
                const link = linkGroup.selectAll('path')
                    .data(this.links)
                    .enter().append('path')
                    .attr('class', d => d.papers && d.papers.length > 0 ? 'link has-papers' : 'link')
                    .attr('stroke', '#5d4037')
                    .attr('stroke-width', d => {
                        const sourceNode = typeof d.source === 'object' ? d.source : this.nodes.find(n => n.id === d.source);
                        if (!sourceNode) return 2;
                        if (sourceNode.level === 0) return 6;
                        if (sourceNode.level === 1) return 4;
                        return 2;
                    })
                    .attr('fill', 'none');

                // „Éé„Éº„Éâ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê
                const nodeGroup = this.svg.append('g').attr('class', 'nodes');
                const node = nodeGroup.selectAll('g')
                    .data(this.nodes)
                    .enter().append('g')
                    .attr('class', 'node')
                    .call(d3.drag()
                        .on('start', (event, d) => this.dragstarted(event, d))
                        .on('drag', (event, d) => this.dragged(event, d))
                        .on('end', (event, d) => this.dragended(event, d)));

                // „Éé„Éº„Éâ„ÅÆÂÜÜ„ÇíËøΩÂä†
                node.append('circle')
                    .attr('r', d => this.nodeRadius[d.level])
                    .attr('class', d => `node-circle level-${d.level}`)
                    .attr('fill', d => {
                        if (d.level === 0) return '#6d4c41';
                        if (d.level === 1) return '#8d6e63';
                        if (d.level === 2) return '#66bb6a';
                        return '#ff6b6b';
                    })
                    .attr('stroke', '#ffffff')
                    .attr('stroke-width', 3);

                // „Éé„Éº„Éâ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíËøΩÂä†ÔºàÁ∏ÅÂèñ„Çä‰ªò„ÅçÔºâ
                node.append('text')
                    .attr('class', 'node-text')
                    .attr('fill', 'white')
                    .attr('font-size', d => this.fontSize[d.level])
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .attr('stroke', '#2e5233')
                    .attr('stroke-width', '3px')
                    .attr('paint-order', 'stroke')
                    .text(d => d.name);
                
                // ÂâçÈù¢„ÅÆ„ÉÜ„Ç≠„Çπ„ÉàÔºàÁôΩËâ≤Ôºâ
                node.append('text')
                    .attr('class', 'node-text')
                    .attr('fill', 'white')
                    .attr('font-size', d => this.fontSize[d.level])
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .text(d => d.name);

                // „Éõ„Éê„Éº„Ç§„Éô„É≥„Éà
                node.on('mouseenter', (event, d) => this.showTooltip(event, d))
                    .on('mouseleave', () => this.hideTooltip())
                    .on('mousemove', (event) => this.updateTooltipPosition(event));

                // Ë´ñÊñá„Åå„ÅÇ„ÇãÊûù„Å´„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÇíËøΩÂä†
                const paperIndicators = linkGroup.selectAll('.paper-indicator')
                    .data(this.links.filter(d => d.papers && d.papers.length > 0))
                    .enter().append('g')
                    .attr('class', 'paper-indicator-group');

                paperIndicators.append('circle')
                    .attr('r', 6)
                    .attr('fill', '#ff6b6b')
                    .attr('class', 'paper-indicator')
                    .on('mouseenter', (event, d) => {
                        const targetNode = typeof d.target === 'object' ? d.target : this.nodes.find(n => n.id === d.target);
                        if (targetNode) {
                            this.showPaperTooltip(event, d.papers, targetNode.name);
                        }
                    })
                    .on('mouseleave', () => this.hidePaperTooltip())
                    .on('mousemove', (event) => this.updatePaperTooltipPosition(event));

                paperIndicators.append('text')
                    .attr('fill', 'white')
                    .attr('font-size', '10px')
                    .attr('font-weight', 'bold')
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .attr('pointer-events', 'none')
                    .attr('stroke', '#8b0000')
                    .attr('stroke-width', '2px')
                    .attr('paint-order', 'stroke')
                    .text(d => d.papers.length);

                // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆ„ÉÜ„Ç£„ÉÉ„ÇØÂá¶ÁêÜ
                this.simulation.on('tick', () => {
                    // „É™„É≥„ÇØ„ÇíÊõ≤Á∑ö„ÅßÊèèÁîª
                    link.attr('d', d => {
                        const source = d.source;
                        const target = d.target;
                        if (!source || !target) return '';
                        const midY = (source.y + target.y) / 2;
                        return `M${source.x},${source.y} C${source.x},${midY} ${target.x},${midY} ${target.x},${target.y}`;
                    });

                    // „Éé„Éº„Éâ„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                    node.attr('transform', d => `translate(${d.x}, ${d.y})`);

                    // Ë´ñÊñá„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                    paperIndicators.attr('transform', d => {
                        if (!d.source || !d.target) return '';
                        const midX = (d.source.x + d.target.x) / 2;
                        const midY = (d.source.y + d.target.y) / 2;
                        return `translate(${midX}, ${midY})`;
                    });
                });

                this.link = link;
                this.node = node;
                this.paperIndicators = paperIndicators;
            }

            dragstarted(event, d) {
                if (!event.active) this.simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            dragended(event, d) {
                if (!event.active) this.simulation.alphaTarget(0);
                // „É¨„Éô„É´0Ôºà„É´„Éº„ÉàÔºâ„ÅØÂõ∫ÂÆö
                if (d.level !== 0) {
                    d.fx = null;
                    d.fy = null;
                }
            }

            setupControls() {
                document.getElementById('restart-simulation').addEventListener('click', () => {
                    // ÂÖ®„Éé„Éº„Éâ„ÅÆÂõ∫ÂÆö„ÇíËß£Èô§„Åó„Å¶„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÂÜçÈñã
                    this.nodes.forEach(d => {
                        if (d.level !== 0) {
                            d.fx = null;
                            d.fy = null;
                        }
                    });
                    this.simulation.alpha(1).restart();
                });

                document.getElementById('freeze-simulation').addEventListener('click', () => {
                    // ÁèæÂú®„ÅÆ‰ΩçÁΩÆ„ÅßÂÖ®„Éé„Éº„Éâ„ÇíÂõ∫ÂÆö
                    this.nodes.forEach(d => {
                        d.fx = d.x;
                        d.fy = d.y;
                    });
                });
            }

            showTooltip(event, node) {
                let content = `<strong>${node.name}</strong><br>${node.description}`;
                if (node.paper) {
                    content = `<strong>${node.paper.title}</strong><br>${node.paper.journal} ${node.paper.year}<br>${node.paper.details}`;
                } else if (node.morePapers) {
                    content = `<strong>ËøΩÂä†„ÅÆË´ñÊñá</strong><br>`;
                    node.morePapers.forEach(paper => {
                        content += `„Éª${paper.title}<br>`;
                    });
                }
                this.tooltip.innerHTML = content;
                this.tooltip.classList.add('visible');
                this.updateTooltipPosition(event);
            }

            hideTooltip() {
                this.tooltip.classList.remove('visible');
            }

            updateTooltipPosition(event) {
                this.tooltip.style.left = `${event.clientX + 10}px`;
                this.tooltip.style.top = `${event.clientY - 10}px`;
            }

            showPaperTooltip(event, papers, categoryName) {
                let html = `<h4>üìö ${categoryName} „ÅÆË´ñÊñá‰∏ÄË¶ß <span class="paper-count">${papers.length}</span></h4>`;
                
                papers.forEach(paper => {
                    html += `
                        <div class="paper-item">
                            <div class="paper-title">${paper.title}</div>
                            <div class="paper-meta">
                                ${paper.journal} ${paper.year} ${paper.details}
                            </div>
                        </div>
                    `;
                });
                
                this.paperTooltip.innerHTML = html;
                this.paperTooltip.classList.add('visible');
                this.updatePaperTooltipPosition(event);
            }

            hidePaperTooltip() {
                this.paperTooltip.classList.remove('visible');
            }

            updatePaperTooltipPosition(event) {
                const tooltipRect = this.paperTooltip.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                let left = event.clientX + 15;
                let top = event.clientY - 15;
                
                if (left + tooltipRect.width > windowWidth) {
                    left = event.clientX - tooltipRect.width - 15;
                }
                
                if (top + tooltipRect.height > windowHeight) {
                    top = windowHeight - tooltipRect.height - 10;
                }
                
                this.paperTooltip.style.left = `${left}px`;
                this.paperTooltip.style.top = `${top}px`;
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÊôÇ„Å´Á≥ªÁµ±Ê®π„Çí‰ΩúÊàê
        document.addEventListener('DOMContentLoaded', function() {
            new TreeChart('tree-chart', treeData);
        });
    </script>
</body>
</html>
