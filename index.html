<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é‡åŸå½©é¦™ã®ç ”ç©¶æˆé•·æ¨¹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Sawarabi+Mincho&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Shippori Mincho", "Sawarabi Mincho", "ãƒ’ãƒ©ã‚®ãƒæ˜æœ Pro", "Hiragino Mincho Pro", serif;
            background: linear-gradient(135deg, #2C1810 0%, #3D2817 50%, #4A3420 100%);
            min-height: 100vh;
            color: #e0e0e0;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 0, 0, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 80% 80%, rgba(0, 0, 255, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 60% 30%, rgba(255, 255, 0, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 30% 70%, rgba(0, 255, 0, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 90% 10%, rgba(255, 0, 255, 0.15) 0%, transparent 30%);
            pointer-events: none;
            z-index: -1;
            animation: twinkle 3s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .main-title {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(33, 24, 16, 0.9), rgba(61, 40, 23, 0.9));
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #B8860B;
        }

        .main-title h1 {
            font-family: "Klee One", "Shippori Mincho", "ãƒ’ãƒ©ã‚®ãƒæ˜æœ Pro", serif;
            font-size: 3.2em;
            color: #FFD700;
            font-weight: 600;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 0.1em;
        }

        .subtitle {
            font-family: "Sawarabi Mincho", "ãƒ’ãƒ©ã‚®ãƒæ˜æœ Pro", serif;
            font-size: 1.3em;
            color: #DAA520;
            font-weight: 400;
            font-style: italic;
            text-shadow: 0 0 10px rgba(218, 165, 32, 0.6);
            letter-spacing: 0.05em;
        }

        .chart-container {
            background: linear-gradient(135deg, rgba(33, 24, 16, 0.95), rgba(61, 40, 23, 0.95));
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            border: 2px solid #B8860B;
            overflow-x: auto;
            position: relative;
        }

        .tree-svg {
            width: 100%;
            height: 1000px;
            min-width: 1600px;
            cursor: move;
        }
        
        .svg-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .node {
            cursor: pointer;
        }

        .node-circle {
            transition: all 0.3s ease;
        }

        .node:hover .node-circle {
            stroke-width: 4;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .node-text {
            font-family: "Shippori Mincho", "Sawarabi Mincho", "ãƒ’ãƒ©ã‚®ãƒæ˜æœ Pro", serif;
            pointer-events: none;
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.8));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .node-text.visible {
            opacity: 1;
        }
        
        .node-text.fixed {
            opacity: 1 !important;
        }

        .link {
            fill: none;
            transition: all 0.3s ease;
        }

        .link:hover {
            filter: brightness(1.5) !important;
        }

        .paper-indicator {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .paper-indicator:hover {
            transform: scale(1.2);
        }

        .paper-tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(15, 15, 15, 0.98), rgba(20, 20, 20, 0.95));
            border: 2px solid #1e9078;
            border-radius: 15px;
            padding: 20px;
            font-size: 0.85em;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1001;
            max-width: 500px;
            min-width: 300px;
            max-height: 600px;
            overflow-y: auto;
        }

        .paper-tooltip.visible {
            opacity: 1;
        }

        .paper-tooltip h4 {
            color: #FFD700;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid #FFA500;
            padding-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
        }

        .paper-item {
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 8px;
            border-left: 3px solid #FF00FF;
        }

        .paper-title {
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 4px;
            line-height: 1.3;
            font-size: 0.9em;
        }

        .paper-meta {
            color: #FFA500;
            font-size: 0.85em;
            font-style: italic;
        }

        .paper-count {
            background: linear-gradient(45deg, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF);
            color: #ffffff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
        }

        .tooltip {
            position: absolute;
            background: rgba(15, 15, 15, 0.95);
            border: 2px solid #1e9078;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.9em;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 300px;
            color: #e0e0e0;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .info-section {
            background: rgba(15, 15, 15, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(30, 144, 120, 0.3);
        }

        .info-section h3 {
            color: #FFD700;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .collaboration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .collaboration-item {
            background: linear-gradient(135deg, rgba(139, 195, 74, 0.1), rgba(165, 214, 167, 0.1));
            border: 1px solid rgba(129, 199, 132, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .collaboration-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(129, 199, 132, 0.2);
        }

        .timeline-items {
            display: grid;
            gap: 15px;
        }

        .timeline-item {
            background: linear-gradient(135deg, rgba(30, 144, 120, 0.1), rgba(124, 252, 0, 0.05));
            border: 1px solid rgba(30, 144, 120, 0.3);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #7CFC00;
            transition: all 0.3s ease;
            color: #e0e0e0;
        }

        .timeline-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(124, 252, 0, 0.2);
        }

        .year {
            font-weight: 600;
            color: #FFD700;
            font-size: 1.1em;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .chart-note {
            text-align: center;
            color: #FFD700;
            font-style: italic;
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 255, 0, 0.1), rgba(0, 255, 0, 0.1));
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid #1e9078;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 0.85em;
            z-index: 10;
            color: #e0e0e0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.8em;
            color: #e0e0e0;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid #1e9078;
            border-radius: 10px;
            padding: 10px;
            font-size: 0.85em;
            z-index: 10;
        }

        .controls button {
            background: #444444;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }

        .controls button:hover {
            background: #666666;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .main-title h1 {
                font-size: 2.2em;
            }
            
            .tree-svg {
                height: 700px;
            }
            
            .main-title {
                padding: 20px;
            }
            
            .chart-container {
                padding: 20px;
            }
            
            .legend {
                position: static;
                margin-bottom: 20px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-title">
            <h1>ğŸŒ³ å°é‡åŸå½©é¦™ã®ç ”ç©¶æˆé•·æ¨¹</h1>
            <div class="subtitle">æ ¹ã‹ã‚‰å¹¹ã€æã‚’çµŒã¦è‘‰ã¸ã¨æˆé•·ã™ã‚‹ç ”ç©¶ã®ç³»çµ±ç™ºç”Ÿ - åŠ›å­¦çš„é…ç½®ã«ã‚ˆã‚Šè‡ªç„¶ã«åºƒãŒã‚‹çŸ¥è­˜ã®æ¨¹</div>
            <p><a href="https://en.wikipedia.org/wiki/The_Tree_of_Life,_Stoclet_Frieze">ã‚¯ãƒªãƒ ãƒˆã®ç”Ÿå‘½ã®æ¨¹</a>ã€<a href="[https://tarabooks.com/shop/the-night-life-of-trees/]">å¤œã®æœ¨</a>ã€<a href="[https://ja.wikipedia.org/wiki/%E3%83%A2%E3%83%81%E3%83%A2%E3%83%81%E3%81%AE%E6%9C%A8]">ãƒ¢ãƒãƒ¢ãƒã®æ¨¹</a>ãªã©ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ä½œæˆã—ã¦ã„ã¾ã™ã€‚</p>
        </div>
        
        <div class="chart-container">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-circle" style="background: #8B4513;"></div>
                    <span>æ ¹ã£ã“ï¼šç ”ç©¶è€…</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: linear-gradient(45deg, #8B4513, #CD853F, #DAA520, #FFD700);"></div>
                    <span>å¹¹ãƒ»æï¼šç ”ç©¶åˆ†é‡</span>
                </div>
                <div class="legend-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <span style="font-size: 0.7em; color: #FFD700;">è«–æ–‡ãƒãƒ¼ãƒ‰ã®è‰²ï¼šå¹´ä»£åˆ¥</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #FF0000;"></div>
                    <span style="font-size: 0.7em;">2010-2012å¹´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #FF7F00;"></div>
                    <span style="font-size: 0.7em;">2013-2015å¹´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #FFFF00;"></div>
                    <span style="font-size: 0.7em;">2016-2018å¹´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #00FF00;"></div>
                    <span style="font-size: 0.7em;">2019-2022å¹´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #0000FF;"></div>
                    <span style="font-size: 0.7em;">2023-2024å¹´</span>
                </div>
                <div class="legend-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <span style="font-size: 0.7em; color: #FFD700;">ã‚¨ãƒƒã‚¸</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #B8860B;"></div>
                    <span style="font-size: 0.7em;">ç ”ç©¶ã®ç¹‹ãŒã‚Šï¼ˆæ¸¦å·»ãï¼‰</span>
                </div>
                <div class="legend-item" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <span style="font-size: 0.7em; color: #FFD700;">æ“ä½œæ–¹æ³•</span>
                </div>
                <div class="legend-item">
                    <span style="font-size: 0.7em;">ãƒ»ãƒãƒ¼ãƒ‰ã‚’ãƒ›ãƒãƒ¼ï¼šãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º</span>
                </div>
                <div class="legend-item">
                    <span style="font-size: 0.7em;">ãƒ»ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼šè¡¨ç¤ºå›ºå®š</span>
                </div>
                <div class="legend-item">
                    <span style="font-size: 0.7em;">ãƒ»èƒŒæ™¯ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼šå…¨è§£é™¤</span>
                </div>
            </div>
            <div class="controls">
                <button id="restart-simulation">é…ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                <button id="freeze-simulation">é…ç½®ã‚’å›ºå®š</button>
                <button id="reset-zoom">è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <svg class="tree-svg" id="tree-chart"></svg>
            <div class="chart-note">
                ğŸŒ³ åŠ›å­¦çš„é…ç½®ã«ã‚ˆã‚Šè‡ªç„¶ã«åºƒãŒã‚‹ç ”ç©¶ç³»çµ±æ¨¹<br>
                ğŸ” ãƒãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é…ç½®ã‚’èª¿æ•´ã§ãã¾ã™<br>
                ğŸ“ ãƒãƒ¼ãƒ‰ã«ãƒã‚¦ã‚¹ã‚’é‡ã­ã‚‹ã¨ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã€ã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤ºã‚’å›ºå®šã§ãã¾ã™
            </div>
        </div>

        <div class="info-section">
            <h3>ğŸ“… ç ”ç©¶ç™ºå±•ã®æ™‚ç³»åˆ—</h3>
            <div class="timeline-items">
                <div class="timeline-item">
                    <span class="year">2024å¹´:</span> å¯¾è©±å‹AIãƒ¢ãƒ‡ãƒ«ã¨éŸ³å£°æŠ€è¡“ã®æ•™è‚²å¿œç”¨
                </div>
                <div class="timeline-item">
                    <span class="year">2023å¹´:</span> ãƒ™ã‚¤ã‚¸ã‚¢ãƒ³ç³»çµ±ç™ºç”Ÿè§£æè«–æ–‡ (Journal of Language Evolution)
                </div>
                <div class="timeline-item">
                    <span class="year">2022å¹´:</span> é€²åŒ–çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ãƒ³ãƒˆæ©Ÿèƒ½ç ”ç©¶é–‹å§‹
                </div>
                <div class="timeline-item">
                    <span class="year">2018-2023å¹´:</span> é›†å›£æ§‹é€ ã‚’è€ƒæ…®ã—ãŸè¨€èªå¤‰åŒ–ãƒ—ãƒ­ã‚»ã‚¹ç ”ç©¶
                </div>
                <div class="timeline-item">
                    <span class="year">2016-2019å¹´:</span> è¨€èªå¤‰åŒ–è¦å› ã¨ç³»è­œã®å®šé‡çš„è©•ä¾¡ç ”ç©¶
                </div>
                <div class="timeline-item">
                    <span class="year">2013-2017å¹´:</span> æ•°ç†çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹è¨€èªå‹•æ…‹ç ”ç©¶ï¼ˆåšå£«ç ”ç©¶ï¼‰
                </div>
                <div class="timeline-item">
                    <span class="year">2010-2013å¹´:</span> æ–¹è¨€åˆ†å¸ƒãƒ»æ–‡åŒ–é ˜åŸŸåˆ†æã®åŸºç¤ç ”ç©¶
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>
    <div class="paper-tooltip" id="paper-tooltip"></div>

    <script>
        // ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ï¼ˆè«–æ–‡æƒ…å ±ä»˜ãï¼‰- è«–æ–‡ã‚’ç¬¬4éšå±¤ã¨ã—ã¦è¿½åŠ  
        const treeData = {
            name: 'å°é‡åŸå½©é¦™',
            description: 'è¨€èªå­¦ãƒ»æ–‡åŒ–é€²åŒ–ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ç ”ç©¶è€…',
            level: 0,
            children: [
                {
                    name: 'æ–‡åŒ–é€²åŒ–ç†è«–',
                    description: 'æ–‡åŒ–ä¼é”ãƒ¢ãƒ‡ãƒ«ãƒ»å®šé‡åˆ†æ',
                    level: 1,
                    children: [
                        {
                            name: 'è¨€èªé€²åŒ–ç ”ç©¶',
                            description: 'ãƒ™ã‚¤ã‚¸ã‚¢ãƒ³ç³»çµ±ç™ºç”Ÿè§£æãƒ»ã‚¢ã‚¯ã‚»ãƒ³ãƒˆç ”ç©¶',
                            level: 2,
                            children: [
                                { 
                                    name: 'ã‚¢ã‚¯ã‚»ãƒ³ãƒˆç³»çµ±ç™ºç”Ÿå­¦', 
                                    description: 'ãƒ™ã‚¤ã‚¸ã‚¢ãƒ³ç³»çµ±ç™ºç”Ÿè§£æã«ã‚ˆã‚‹ãƒ”ãƒƒãƒã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ', 
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'Bayesian phylogenetic analysis of pitch-accent systems based on accentual class merger: a new method applied to Japanese dialects',
                                            journal: 'Journal of Language Evolution',
                                            year: '2024',
                                            details: '8(2) 169-191, æŸ»èª­æœ‰ã‚Š'
                                        },
                                        {
                                            title: 'Inferring the temporal and spatial evolution of accent systems in Japanese dialects: a phylogeographic approach',
                                            journal: 'Proceedings of the Joint Conference on Language Evolution',
                                            year: '2022',
                                            details: 'æŸ»èª­æœ‰ã‚Š'
                                        }
                                    ]
                                },
                                { 
                                    name: 'æ–¹è¨€ã®æ™‚ç©ºé–“å¤‰ç•°', 
                                    description: 'æ—¥æœ¬èªæ–¹è¨€ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®æ™‚ç©ºé–“é€²åŒ–', 
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'è¨€èªã®æ¶ˆå¤±ã¨ç²å¾—ã«é–¢é€£ã™ã‚‹ç’°å¢ƒãƒ»ç¤¾ä¼šçš„è¦å› ',
                                            journal: 'GISï¼ç†è«–ã¨å¿œç”¨',
                                            year: '2016',
                                            details: '24(2), æ‹›å¾…æœ‰ã‚Š'
                                        },
                                        {
                                            title: 'æ—¥æœ¬èªæ–¹è¨€ã®æ¨å®šã•ã‚ŒãŸã‚¢ã‚¯ã‚»ãƒ³ãƒˆé¡åˆ¥ã®ä½µåˆç‡ã®ç³»çµ±åœ°ç†',
                                            journal: 'GISï¼ç†è«–ã¨å¿œç”¨',
                                            year: '2016',
                                            details: '24(2), æ‹›å¾…æœ‰ã‚Š'
                                        },
                                        {
                                            title: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®æ–‡åŒ–ä¼é”ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹æ—¥æœ¬èªã‚¢ã‚¯ã‚»ãƒ³ãƒˆæ§˜å¼ã®å¤‰ç•°ç‡ãƒ»ç³»çµ±é–¢ä¿‚ã®æ¨å®š',
                                            journal: 'å›½ç«‹å›½èªç ”ç©¶æ‰€ æ™‚ç©ºé–“å¤‰ç•°ç ”ç©¶ç³» åˆåŒç ”ç©¶ç™ºè¡¨ä¼š JLVC2012 äºˆç¨¿é›†',
                                            year: '2012',
                                            details: '43-46, æŸ»èª­æœ‰ã‚Š'
                                        }
                                    ]
                                },
                                { 
                                    name: 'è¨€èªå¤‰åŒ–ãƒ¢ãƒ‡ãƒ«', 
                                    description: 'æ•°ç†çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹è¨€èªå‹•æ…‹', 
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'æ•°ç†çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‹ã‚‰ã®è¨€èªå¤‰åŒ–ã¨å¤–è¨€èªçš„è¦ç´ ã¨ã®é–¢ã‚ã‚Šã«é–¢ã™ã‚‹ç ”ç©¶',
                                            journal: '',
                                            year: '2014',
                                            details: 'æŸ»èª­æœ‰ã‚Šç­†é ­è‘—è€…'
                                        },
                                        {
                                            title: 'äº¤é€šç³»çµ±è¨ˆæƒ…å ±ã®åˆ†å¸ƒã¨è¨€èªå¤–çš„è¦ç´ ã«é–¢ã™ã‚‹ç ”ç©¶',
                                            journal: 'æƒ…å ±å‡¦ç†å­¦ä¼šã‚·ãƒ³ãƒã‚¸ã‚¦ãƒ è«–æ–‡é›†',
                                            year: '2010',
                                            details: '2010(15) 239-246, æŸ»èª­æœ‰ã‚Š'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            name: 'GISãƒ»ç©ºé–“åˆ†æ',
                            description: 'åœ°ç†æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ãƒ»æ©Ÿæ¢°å­¦ç¿’å¿œç”¨',
                            level: 2,
                            children: [
                                { 
                                    name: 'ãƒ¯ã‚¤ãƒ³æ ½åŸ¹é©åœ°', 
                                    description: 'æ©Ÿæ¢°å­¦ç¿’ã‚’ç”¨ã„ãŸãƒ¯ã‚¤ãƒ³ç”¨ãƒ–ãƒ‰ã‚¦æ ½åŸ¹é©åœ°æ¨å®š', 
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'æ©Ÿæ¢°å­¦ç¿’ã‚’ç”¨ã„ãŸãƒ¯ã‚¤ãƒ³ç”¨ãƒ–ãƒ‰ã‚¦æ ½åŸ¹é©åœ°ã®æ¨å®š',
                                            journal: 'GIS-ç†è«–ã¨å¿œç”¨',
                                            year: '2023',
                                            details: '31(2) 78-78, æ‹›å¾…æœ‰ã‚Š'
                                        },
                                        {
                                            title: 'CLIENT-SIDE WEB MAPPING SYSTEM FOR VINEYARD SUITABILITY ASSESSMENT',
                                            journal: 'The International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences',
                                            year: '2022',
                                            details: 'XLVIII-4/W1-2022 223-228, æŸ»èª­æœ‰ã‚Š'
                                        }
                                    ]
                                },
                                { 
                                    name: 'ç©ºé–“è¨€èªå­¦', 
                                    description: 'è¨€èªå¤‰åŒ–ã®åœ°ç†çš„ãƒ‘ã‚¿ãƒ¼ãƒ³', 
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'è¨€èªã®æ¶ˆå¤±ã¨ç²å¾—ã«é–¢é€£ã™ã‚‹ç’°å¢ƒãƒ»ç¤¾ä¼šçš„è¦å› ',
                                            journal: 'åœ°ç†æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ å­¦ä¼šè¬›æ¼”è«–æ–‡é›†(CD-ROM)',
                                            year: '2016',
                                            details: '25 40-40, ç­†é ­è‘—è€…è²¬ä»»è‘—è€…'
                                        },
                                        {
                                            title: 'æ–¹è¨€åˆ†å¸ƒã‹ã‚‰è¦‹ãŸæ–‡åŒ–äº‹è±¡ã®æµé€šã¨æ»ç•™â€•å²é˜œçœŒã«ãŠã‘ã‚‹æ–¹è¨€åˆ†å¸ƒã®äº‹ä¾‹â€•',
                                            journal: 'åœ°ç†æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ å­¦ä¼šè¬›æ¼”è«–æ–‡é›†(CD-ROM)',
                                            year: '2010',
                                            details: '19, 473-480'
                                        }
                                    ]
                                },
                                {
                                    name: 'AIãƒ»æ•™è‚²æŠ€è¡“',
                                    description: 'ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹æ•™è‚²ãƒ»AIå¿œç”¨',
                                    level: 3,
                                    papers: [
                                        {
                                            title: 'å¯¾è©±å‹AIãƒ¢ãƒ‡ãƒ«ä¸¦ã³ã«AIéŸ³å£°ã‚’æ´»ç”¨ã—ãŸæ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ â€•AIæŠ€è¡“ã®æ–°ãŸãªå±•é–‹â€•',
                                            journal: 'ç¤¾ä¼šã¨çµ±è¨ˆ',
                                            year: '2024',
                                            details: '(10) 27-44'
                                        },
                                        {
                                            title: 'Python ã‚’åˆ©ç”¨ã—ãŸåœ°ç†ç·åˆå®Ÿç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½œæˆ',
                                            journal: 'æ—¥æœ¬åœ°ç†å­¦ä¼šç™ºè¡¨è¦æ—¨é›†',
                                            year: '2023',
                                            details: '2023s. P007'
                                        }
                                    ]
                                }
                            ]
                        },
                        { 
                            name: 'æ–‡åŒ–å¤šæ§˜æ€§æ©Ÿæ§‹', 
                            description: 'æ–‡åŒ–çš„å¤šæ§˜æ€§ã®é€²åŒ–ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ', 
                            level: 2,
                            papers: [
                                {
                                    title: 'é›‘èªŒã€Œè¡Œå‹•è¨ˆé‡å­¦ã€ã«ãŠã‘ã‚‹è¨€èªã«é–¢ã™ã‚‹æŠ•ç¨¿è«–æ–‡ã®å‚¾å‘',
                                    journal: 'æ—¥æœ¬è¡Œå‹•è¨ˆé‡å­¦ä¼šå¤§ä¼šç™ºè¡¨è«–æ–‡æŠ„éŒ²é›†',
                                    year: '2012',
                                    details: '40 415-418'
                                }
                            ]
                        },
                        { 
                            name: 'æ–‡åŒ–ä¼é”ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', 
                            description: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®æ–‡åŒ–ä¼é”ãƒ¢ãƒ‡ãƒ«', 
                            level: 2,
                            papers: [
                                {
                                    title: 'ITMAã«ãŠã‘ã‚‹NCDã®å®Ÿç”¨æ€§ã¨UMLã‚’ç”¨ã„ãŸåˆ†æãƒ—ãƒ­ã‚»ã‚¹ã®å¯è¦–åŒ–ã¨å…±æœ‰ã«ã¤ã„ã¦',
                                    journal: 'æƒ…å ±å‡¦ç†å­¦ä¼šã‚·ãƒ³ãƒã‚¸ã‚¦ãƒ è«–æ–‡é›†',
                                    year: '2010',
                                    details: '2010(15) 239-246, æŸ»èª­æœ‰ã‚Š'
                                },
                                {
                                    title: 'å²é˜œçœŒæ—§å¾³å±±æ‘ã«ãŠã‘ã‚‹ã‚¢ã‚¯ã‚»ãƒ³ãƒˆæ§˜ç›¸ã¨äº¤é€šçŠ¶æ³ã¨ã®é–¢ä¿‚æ€§-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†æã‚’ç”¨ã„ãŸã‚¢ã‚¯ã‚»ãƒ³ãƒˆåˆ†å¸ƒã¨äº¤é€šçŠ¶æ³ã®é¡ä¼¼æ€§ã®ç®—å‡º-',
                                    journal: 'æƒ…å ±å‡¦ç†å­¦ä¼šã‚·ãƒ³ãƒã‚¸ã‚¦ãƒ è«–æ–‡é›†',
                                    year: '2011',
                                    details: '2011(8) 219-224, æŸ»èª­æœ‰ã‚Šç­†é ­è‘—è€…'
                                }
                            ]
                        },
                        { 
                            name: 'å®šé‡çš„æ–¹è¨€å­¦', 
                            description: 'å²é˜œçœŒæ–¹è¨€èªå½™ã«ã‚ˆã‚‹æ–‡åŒ–é ˜åŸŸæŠ½å‡º', 
                            level: 2,
                            papers: [
                                {
                                    title: 'å²é˜œçœŒæ–¹è¨€èªå½™ã«ã‚ˆã‚‹ä»®æƒ³çš„æ–‡åŒ–é ˜åŸŸæŠ½å‡ºã¨èªå½™å¤‰åŒ–ã®æ–¹å‘',
                                    journal: 'ç ”ç©¶å ±å‘Šäººæ–‡ç§‘å­¦ã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ï¼ˆCHï¼‰',
                                    year: '2012',
                                    details: '2012(4) 1-6, ç­†é ­è‘—è€…'
                                },
                                {
                                    title: 'æ–æ–å·ä¸ŠæµåŸŸã«ãŠã‘ã‚‹èªå½™ã®é¡å‹ã¨åœ°ç†çš„åˆ†å¸ƒ',
                                    journal: 'æ–‡åŒ–æƒ…å ±å­¦',
                                    year: '2012',
                                    details: '8(1) 1-11, æŸ»èª­æœ‰ã‚Šç­†é ­è‘—è€…'
                                },
                                {
                                    title: 'æ–æ–å·ä¸ŠæµåŸŸã®èªå½™ã«é–¢ã™ã‚‹ç³»çµ±æ¨å®š',
                                    journal: 'ç ”ç©¶å ±å‘Šäººæ–‡ç§‘å­¦ã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ï¼ˆCHï¼‰',
                                    year: '2012',
                                    details: '2012(4) 1-6'
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        class TreeChart {
            constructor(svgId, data) {
                this.svgElement = document.getElementById(svgId);
                this.data = data;
                this.tooltip = document.getElementById('tooltip');
                this.paperTooltip = document.getElementById('paper-tooltip');
                this.width = 1600;
                this.height = 1000;
                this.nodeRadius = { 0: 30, 1: 25, 2: 20, 3: 15, 4: 12, 5: 16 };  // ãƒ¬ãƒ™ãƒ«5ï¼ˆè«–æ–‡ï¼‰ã‚’å¤§ãã
                this.fontSize = { 0: '16px', 1: '14px', 2: '12px', 3: '10px', 4: '9px', 5: '8px' };
                this.init();
            }

            init() {
                // D3.jsã§SVGã‚’è¨­å®š
                this.svg = d3.select(this.svgElement)
                    .attr('viewBox', `0 0 ${this.width} ${this.height}`);
                
                // ã‚ºãƒ¼ãƒ æ©Ÿèƒ½ã‚’è¿½åŠ 
                this.g = this.svg.append('g');
                
                // ã‚ºãƒ¼ãƒ å‹•ä½œã‚’å®šç¾©
                this.zoom = d3.zoom()
                    .scaleExtent([0.5, 2])  // ã‚ºãƒ¼ãƒ ç¯„å›²: 50%ã€œ200%
                    .on('zoom', (event) => {
                        this.g.attr('transform', event.transform);
                    });
                
                // SVGã«ã‚ºãƒ¼ãƒ å‹•ä½œã‚’é©ç”¨
                this.svg.call(this.zoom);
                
                // åˆæœŸã‚ºãƒ¼ãƒ ã‚’å°‘ã—ç¸®å°ã—ã¦å…¨ä½“ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
                this.svg.call(this.zoom.transform, d3.zoomIdentity.scale(0.85));
                
                // èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©
                const defs = this.g.append('defs');
                const gradient = defs.append('radialGradient')
                    .attr('id', 'treeGradient')
                    .attr('cx', '50%')
                    .attr('cy', '100%')
                    .attr('r', '100%');
                
                gradient.append('stop')
                    .attr('offset', '0%')
                    .attr('stop-color', '#D4AF37')
                    .attr('stop-opacity', 0.1);
                
                gradient.append('stop')
                    .attr('offset', '50%')
                    .attr('stop-color', '#FFD700')
                    .attr('stop-opacity', 0.05);
                
                gradient.append('stop')
                    .attr('offset', '100%')
                    .attr('stop-color', '#B8860B')
                    .attr('stop-opacity', 0.02);
                
                // è£…é£¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©
                const pattern = defs.append('pattern')
                    .attr('id', 'klimtPattern')
                    .attr('patternUnits', 'userSpaceOnUse')
                    .attr('width', 40)
                    .attr('height', 40);
                
                // å°ã•ãªæ¸¦å·»ãæ¨¡æ§˜
                pattern.append('circle')
                    .attr('cx', 20)
                    .attr('cy', 20)
                    .attr('r', 3)
                    .attr('fill', 'none')
                    .attr('stroke', '#FFD700')
                    .attr('stroke-width', 0.5)
                    .attr('opacity', 0.3);
                
                pattern.append('path')
                    .attr('d', 'M20,20 Q25,15 30,20 T40,20')
                    .attr('fill', 'none')
                    .attr('stroke', '#DAA520')
                    .attr('stroke-width', 0.5)
                    .attr('opacity', 0.2);
                
                // èƒŒæ™¯ã‚’è¿½åŠ 
                this.g.append('rect')
                    .attr('width', this.width)
                    .attr('height', this.height)
                    .attr('fill', 'url(#treeGradient)')
                    .on('click', () => {
                        // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã®å›ºå®šã‚’è§£é™¤
                        this.g.selectAll('.node-text').classed('fixed', false).classed('visible', false);
                    });
                
                // è£…é£¾ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼
                this.g.append('rect')
                    .attr('width', this.width)
                    .attr('height', this.height)
                    .attr('fill', 'url(#klimtPattern)')
                    .attr('opacity', 0.15)
                    .style('pointer-events', 'none');
                
                this.processData();
                this.createForceSimulation();
                this.setupControls();
            }

            processData() {
                const nodes = [];
                const links = [];
                let nodeId = 0;
                const height = this.height;
                const width = this.width;
                
                // ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰
                const root = {
                    id: nodeId++,
                    name: this.data.name,
                    description: this.data.description,
                    level: 0,
                    x: width / 2,
                    y: height - 100,
                    fx: width / 2,  // å›ºå®šXåº§æ¨™
                    fy: height - 100  // å›ºå®šYåº§æ¨™ï¼ˆä¸‹éƒ¨ï¼‰
                };
                nodes.push(root);

                // å†å¸°çš„ã«ãƒãƒ¼ãƒ‰ã¨ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                const processChildren = (parent, children, level) => {
                    if (!children) return;
                    
                    children.forEach((child, i) => {
                        const node = {
                            id: nodeId++,
                            name: child.name,
                            description: child.description,
                            level: level,
                            papers: child.papers || []
                        };
                        
                        // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦åˆæœŸåº§æ¨™ã‚’è¨­å®š
                        if (level === 1) {
                            node.x = width / 2 + (Math.random() - 0.5) * 200;  // ã‚ˆã‚Šä¸­å¤®å¯„ã‚Šã«
                            node.y = height - 250;
                        } else if (level === 2) {
                            node.x = width / 2 + (Math.random() - 0.5) * 400;  // é©åº¦ã«åˆ†æ•£
                            node.y = height - 500;
                        } else {
                            node.x = width / 2 + (Math.random() - 0.5) * 600;  // ä¸Šéƒ¨ã¯å°‘ã—åºƒã‚ã«
                            node.y = height - 750;
                        }
                        
                        nodes.push(node);
                        
                        // ãƒªãƒ³ã‚¯ã‚’ä½œæˆï¼ˆç¬¬3éšå±¤ã¸ã®é·ç§»ã®å ´åˆã®ã¿papersã‚’å«ã‚ã‚‹ï¼‰
                        if (parent.level === 1 && child.papers && child.papers.length > 0) {
                            links.push({ source: parent.id, target: node.id, papers: child.papers });
                        } else {
                            links.push({ source: parent.id, target: node.id });
                        }
                        
                        // å­ãƒãƒ¼ãƒ‰ã‚’å‡¦ç†
                        if (child.children) {
                            processChildren(node, child.children, level + 1);
                        }
                        
                        // è«–æ–‡ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ï¼ˆpapersé…åˆ—ãŒã‚ã‚‹å ´åˆã€ä»»æ„ã®ãƒ¬ãƒ™ãƒ«ã§ï¼‰
                        if (child.papers && child.papers.length > 0) {
                            const maxPapers = 5;
                            const papersToShow = Math.min(child.papers.length, maxPapers);
                            
                            child.papers.slice(0, papersToShow).forEach((paper, k) => {
                                const paperNode = {
                                    id: nodeId++,
                                    name: paper.year,
                                    description: paper.title,
                                    level: level + 1,  // è¦ªãƒãƒ¼ãƒ‰ã®æ¬¡ã®ãƒ¬ãƒ™ãƒ«
                                    paper: paper,
                                    x: node.x || width / 2,  // è¦ªãƒãƒ¼ãƒ‰ã®Xåº§æ¨™ã‚’ä½¿ç”¨
                                    y: height - (200 + level * 150)  // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦Yåº§æ¨™ã‚’è¨­å®š
                                };
                                nodes.push(paperNode);
                                links.push({ source: node.id, target: paperNode.id });
                            });
                            
                            // è¿½åŠ ã®è«–æ–‡ãƒãƒ¼ãƒ‰
                            if (child.papers.length > maxPapers) {
                                const moreNode = {
                                    id: nodeId++,
                                    name: `+${child.papers.length - maxPapers}`,
                                    description: `ä»–${child.papers.length - maxPapers}ä»¶ã®è«–æ–‡`,
                                    level: level + 1,  // è¦ªãƒãƒ¼ãƒ‰ã®æ¬¡ã®ãƒ¬ãƒ™ãƒ«
                                    morePapers: child.papers.slice(maxPapers),
                                    x: node.x || width / 2,  // è¦ªãƒãƒ¼ãƒ‰ã®Xåº§æ¨™ã‚’ä½¿ç”¨
                                    y: height - (200 + level * 150)
                                };
                                nodes.push(moreNode);
                                links.push({ source: node.id, target: moreNode.id });
                            }
                        }
                    });
                };

                processChildren(root, this.data.children, 1);
                
                this.nodes = nodes;
                this.links = links;
                
                // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šãƒãƒ¼ãƒ‰ã¨ãƒªãƒ³ã‚¯ã®æ•°ã‚’ç¢ºèª
                console.log('Total nodes:', this.nodes.length);
                console.log('Total links:', this.links.length);
            }

            createForceSimulation() {
                // å¹´ä»£ã«ã‚ˆã‚‹è‰²ã‚’è¿”ã™é–¢æ•°
                const getYearColor = (papers) => {
                    if (!papers || papers.length === 0) return '#FFD700'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šã‚´ãƒ¼ãƒ«ãƒ‰
                    
                    // æœ€æ–°ã®è«–æ–‡ã®å¹´ã‚’å–å¾—
                    const latestYear = Math.max(...papers.map(p => parseInt(p.year) || 2010));
                    
                    // å¹´ä»£ã«å¿œã˜ã¦æ˜ç¢ºã«è‰²ã‚’å‰²ã‚Šå½“ã¦
                    if (latestYear >= 2023) return '#0000FF';      // 2023-2024å¹´ï¼šé’
                    else if (latestYear >= 2019) return '#00FF00'; // 2019-2022å¹´ï¼šç·‘
                    else if (latestYear >= 2016) return '#FFFF00'; // 2016-2018å¹´ï¼šé»„è‰²
                    else if (latestYear >= 2013) return '#FF7F00'; // 2013-2015å¹´ï¼šã‚ªãƒ¬ãƒ³ã‚¸
                    else return '#FF0000';                         // 2010-2012å¹´ï¼šèµ¤
                };
                
                // ãƒãƒ¼ãƒ‰ã®æœ€æ–°è«–æ–‡å¹´ã‚’å–å¾—ã™ã‚‹é–¢æ•°
                const getLatestYear = (node) => {
                    if (node.paper) return parseInt(node.paper.year) || 2010;
                    if (node.papers && node.papers.length > 0) {
                        return Math.max(...node.papers.map(p => parseInt(p.year) || 2010));
                    }
                    // å­ãƒãƒ¼ãƒ‰ã‹ã‚‰æœ€æ–°å¹´ã‚’å–å¾—
                    let latestYear = 2010;
                    this.nodes.forEach(n => {
                        if (n.level === node.level + 1) {
                            // å­ãƒãƒ¼ãƒ‰ã‹ã©ã†ã‹ã‚’ãƒªãƒ³ã‚¯ã§ç¢ºèª
                            const isChild = this.links.some(l => 
                                (l.source === node.id || l.source.id === node.id) && 
                                (l.target === n.id || l.target.id === n.id)
                            );
                            if (isChild) {
                                const childYear = getLatestYear(n);
                                latestYear = Math.max(latestYear, childYear);
                            }
                        }
                    });
                    return latestYear;
                };
                
                // ãƒãƒ¼ãƒ‰IDã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒãƒƒãƒ—ã‚’ä½œæˆ
                this.nodeMap = {};
                this.nodes.forEach((node, i) => {
                    this.nodeMap[node.id] = i;
                });
                
                // åŠ›å­¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
                this.simulation = d3.forceSimulation(this.nodes)
                    .force('link', d3.forceLink(this.links)
                        .id(d => d.id)
                        .distance(d => {
                            // ãƒ©ãƒ³ãƒ€ãƒ ãªé•·ã•ã‚’è¨­å®š
                            const sourceNode = typeof d.source === 'object' ? d.source : this.nodes.find(n => n.id === d.source);
                            const targetNode = typeof d.target === 'object' ? d.target : this.nodes.find(n => n.id === d.target);
                            if (!sourceNode || !targetNode) return 100;
                            
                            // ãƒ¬ãƒ™ãƒ«ã”ã¨ã®åŸºæœ¬è·é›¢ã«ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã‚’è¿½åŠ 
                            let baseDistance;
                            if (sourceNode.level === 0) baseDistance = 200;
                            else if (sourceNode.level === 1) baseDistance = 160;
                            else if (sourceNode.level === 2) baseDistance = 120;
                            else baseDistance = 80;
                            
                            // Â±50%ã®ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã‚’è¿½åŠ 
                            return baseDistance * (0.5 + Math.random());
                        })
                        .strength(0.8))
                    .force('charge', d3.forceManyBody()
                        .strength(d => {
                            // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦åç™ºåŠ›ã‚’èª¿æ•´ï¼ˆè«–æ–‡ãƒãƒ¼ãƒ‰ã¯ç‰¹ã«å¼·ãï¼‰
                            if (d.level === 0) return -3000;
                            if (d.level === 1) return -2500;
                            if (d.level === 2) return -2000;
                            if (d.level === 3) return -1500;
                            if (d.level === 4) return -1200;
                            return -1500; // ãƒ¬ãƒ™ãƒ«5ï¼ˆè«–æ–‡ãƒãƒ¼ãƒ‰ï¼‰ã®åç™ºåŠ›
                        }))
                    .force('x', d3.forceX(d => {
                        // ãƒ¬ãƒ™ãƒ«ã”ã¨ã«ç•°ãªã‚‹Xæ–¹å‘ã®ä¸­å¿ƒã‚’è¨­å®š
                        if (d.level === 0) return this.width / 2; // æ ¹ã¯ä¸­å¤®å›ºå®š
                        
                        // è«–æ–‡ãƒãƒ¼ãƒ‰ã¯è¦ªã®è¿‘ãã«
                        if (d.paper) {
                            const year = parseInt(d.paper.year) || 2010;
                            const yearOffset = (year - 2010) / 14;
                            // æ–°ã—ã„è«–æ–‡ã»ã©å¤–å´ã«åºƒãŒã‚‹ï¼ˆå¹…ã‚’ç‹­ã‚ã‚‹ï¼‰
                            const spread = (Math.random() - 0.5) * 200 * (1 + yearOffset);
                            return this.width / 2 + spread;
                        }
                        
                        // é€šå¸¸ã®ãƒãƒ¼ãƒ‰ã‚‚å¹´ä»£ã«åŸºã¥ã„ã¦å°‘ã—æ¨ªã«åºƒãŒã‚‹
                        const latestYear = getLatestYear(d);
                        const yearOffset = (latestYear - 2010) / 14;
                        const spread = (Math.random() - 0.5) * 100 * yearOffset;
                        
                        return this.width / 2 + spread;
                    }).strength(0.1))  // Xæ–¹å‘ã®åŠ›ã‚’å¼·ã‚ã‚‹
                    .force('y', d3.forceY(d => {
                        // Yæ–¹å‘ã®åŠ›ã‚’èª¿æ•´ã—ã¦éšå±¤æ§‹é€ ã‚’ç¶­æŒ
                        if (d.level === 0) return this.height - 100; // æ ¹ã£ã“ã¯å›ºå®š
                        
                        // è«–æ–‡ãƒãƒ¼ãƒ‰ã¯è¦ªã«è¿‘ã„ä½ç½®
                        if (d.paper) {
                            const year = parseInt(d.paper.year) || 2010;
                            const yearOffset = (year - 2010) / 14; // 0-1ã®ç¯„å›²ã«æ­£è¦åŒ–
                            return this.height - 850 + (1 - yearOffset) * 100; // æ–°ã—ã„ã»ã©ä¸Š
                        }
                        
                        // é€šå¸¸ã®ãƒãƒ¼ãƒ‰ã¯æœ€æ–°è«–æ–‡å¹´ã«åŸºã¥ã„ã¦é…ç½®
                        const latestYear = getLatestYear(d);
                        const yearOffset = (latestYear - 2010) / 14; // 0-1ã®ç¯„å›²ã«æ­£è¦åŒ–
                        
                        // ãƒ¬ãƒ™ãƒ«ã”ã¨ã®åŸºæœ¬ä½ç½®ã«å¹´ä»£ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨
                        let baseY;
                        if (d.level === 1) baseY = this.height - 300;
                        else if (d.level === 2) baseY = this.height - 500;
                        else if (d.level === 3) baseY = this.height - 650;
                        else if (d.level === 4) baseY = this.height - 750;
                        else baseY = this.height - 850;
                        
                        // æ–°ã—ã„è«–æ–‡ã‚’æŒã¤ã»ã©ä¸Šã«é…ç½®ï¼ˆæœ€å¤§150ãƒ”ã‚¯ã‚»ãƒ«ä¸Šæ˜‡ï¼‰
                        return baseY - yearOffset * 150;
                    }).strength(0.7))
                    .force('collision', d3.forceCollide()
                        .radius(d => {
                            // è«–æ–‡ãƒãƒ¼ãƒ‰ã¯æ¸¦å·»ãã‚’è€ƒæ…®ã—ã¦å¤§ãã‚ã®è¡çªåŠå¾„
                            if (d.paper) return this.nodeRadius[d.level] + 60;
                            if (d.level >= 3) return this.nodeRadius[d.level] + 40;
                            return this.nodeRadius[d.level] + 30;
                        })
                        .strength(0.8));

                // ãƒªãƒ³ã‚¯ã‚’æç”»
                const linkGroup = this.g.append('g').attr('class', 'links');
                const link = linkGroup.selectAll('path')
                    .data(this.links)
                    .enter().append('path')
                    .attr('class', d => d.papers && d.papers.length > 0 ? 'link has-papers' : 'link')
                    .attr('stroke', '#B8860B')  // ãƒ€ãƒ¼ã‚¯ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ­ãƒƒãƒ‰
                    .attr('stroke-width', d => {
                        const sourceNode = typeof d.source === 'object' ? d.source : this.nodes.find(n => n.id === d.source);
                        if (!sourceNode) return 2;
                        if (sourceNode.level === 0) return 4;
                        if (sourceNode.level === 1) return 3;
                        return 2;
                    })
                    .attr('fill', 'none')
                    .style('filter', 'drop-shadow(0 0 3px #DAA520)')
                    .attr('opacity', 0.8);

                // ãƒãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
                const nodeGroup = this.g.append('g').attr('class', 'nodes');
                const node = nodeGroup.selectAll('g')
                    .data(this.nodes)
                    .enter().append('g')
                    .attr('class', 'node')
                    .style('cursor', 'pointer')
                    .call(d3.drag()
                        .on('start', (event, d) => this.dragstarted(event, d))
                        .on('drag', (event, d) => this.dragged(event, d))
                        .on('end', (event, d) => this.dragended(event, d)));

                // ãƒãƒ¼ãƒ‰ã®å††ã‚’è¿½åŠ 
                node.append('circle')
                    .attr('r', d => {
                        // è«–æ–‡ãƒãƒ¼ãƒ‰ã¯2å€ã®ã‚µã‚¤ã‚º
                        if (d.paper) return 16;
                        return this.nodeRadius[d.level] || 12;
                    })
                    .attr('class', d => `node-circle level-${d.level}`)
                    .attr('fill', d => {
                        // è‘‰ï¼ˆè«–æ–‡ãƒãƒ¼ãƒ‰ï¼‰ã®å ´åˆã‚’æœ€åˆã«ãƒã‚§ãƒƒã‚¯
                        if (d.paper && d.paper.year) {
                            const color = getYearColor([d.paper]);
                            console.log(`è«–æ–‡ãƒãƒ¼ãƒ‰: ${d.name} (${d.paper.year}) -> ${color}`);
                            return color;
                        }
                        // morePapersãƒãƒ¼ãƒ‰ã®å ´åˆ
                        if (d.morePapers && d.morePapers.length > 0) {
                            const color = getYearColor(d.morePapers);
                            console.log(`è¿½åŠ è«–æ–‡ãƒãƒ¼ãƒ‰: ${d.name} -> ${color}`);
                            return color;
                        }
                        // ãƒ¬ãƒ™ãƒ«2ã¾ãŸã¯ãƒ¬ãƒ™ãƒ«3ã§è«–æ–‡ã‚’æŒã¤ãƒãƒ¼ãƒ‰ã¯èŒ¶è‰²
                        if ((d.level === 2 || d.level === 3) && d.papers && d.papers.length > 0) {
                            return '#8B4513';  // èŒ¶è‰²
                        }
                        // ãã®ä»–ã®è«–æ–‡ãŒã‚ã‚‹å ´åˆã¯å¹´ä»£ã§è‰²åˆ†ã‘
                        if (d.papers && d.papers.length > 0) {
                            const color = getYearColor(d.papers);
                            console.log(`è«–æ–‡ä»˜ããƒãƒ¼ãƒ‰: ${d.name} -> ${color}`);
                            return color;
                        }
                        // ãƒ¬ãƒ™ãƒ«ã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²
                        if (d.level === 0) return '#8B4513';  // æ ¹ã£ã“ï¼šèŒ¶è‰²
                        if (d.level === 1) return '#CD853F';  // æ–‡åŒ–é€²åŒ–ç†è«–ï¼šãƒšãƒ«ãƒ¼è‰²
                        if (d.level === 2) return '#DAA520';  // è¨€èªé€²åŒ–ãƒ»GISï¼šã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ­ãƒƒãƒ‰
                        if (d.level === 3) return '#FFD700';  // è©³ç´°åˆ†é‡ï¼šã‚´ãƒ¼ãƒ«ãƒ‰
                        if (d.level === 4) return '#FFA500';  // AIæ•™è‚²åˆ†é‡ï¼šã‚ªãƒ¬ãƒ³ã‚¸
                        return '#FFD700';  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼šã‚´ãƒ¼ãƒ«ãƒ‰
                    })
                    .attr('stroke', d => {
                        if (d.paper) return '#FFD700';  // è«–æ–‡ãƒãƒ¼ãƒ‰ã¯ã‚´ãƒ¼ãƒ«ãƒ‰ã®ç¸
                        return '#8B4513';  // ãã®ä»–ã¯èŒ¶è‰²ã®ç¸
                    })
                    .attr('stroke-width', d => d.paper ? 3 : 2)
                    .style('filter', d => {
                        // è«–æ–‡ãƒãƒ¼ãƒ‰ã®å ´åˆ
                        if (d.paper && d.paper.year) {
                            const color = getYearColor([d.paper]);
                            return `drop-shadow(0 0 15px ${color})`;
                        }
                        // morePapersãƒãƒ¼ãƒ‰ã®å ´åˆ
                        if (d.morePapers && d.morePapers.length > 0) {
                            const color = getYearColor(d.morePapers);
                            return `drop-shadow(0 0 15px ${color})`;
                        }
                        // ãƒ¬ãƒ™ãƒ«2ã¾ãŸã¯ãƒ¬ãƒ™ãƒ«3ã§è«–æ–‡ã‚’æŒã¤ãƒãƒ¼ãƒ‰ã¯èŒ¶è‰²ã®ã‚·ãƒ£ãƒ‰ã‚¦
                        if ((d.level === 2 || d.level === 3) && d.papers && d.papers.length > 0) {
                            return 'drop-shadow(0 0 10px #8B4513)';
                        }
                        // ãã®ä»–ã®è«–æ–‡ã‚’æŒã¤é€šå¸¸ãƒãƒ¼ãƒ‰ã®å ´åˆ
                        if (d.papers && d.papers.length > 0) {
                            const color = getYearColor(d.papers);
                            return `drop-shadow(0 0 10px ${color})`;
                        }
                        if (d.level === 3) {
                            return 'drop-shadow(0 0 15px #FFD700)';
                        }
                        return 'drop-shadow(0 0 10px rgba(139, 69, 19, 0.8))';
                    });
                
                // è«–æ–‡ãƒãƒ¼ãƒ‰ã«è£…é£¾çš„ãªå¤–å††ã‚’è¿½åŠ 
                node.filter(d => d.paper)
                    .append('circle')
                    .attr('r', d => this.nodeRadius[d.level] + 8)  // å¤–å††ã®ã‚µã‚¤ã‚ºã‚‚å¤§ãã
                    .attr('fill', 'none')
                    .attr('stroke', '#FFD700')
                    .attr('stroke-width', 1.5)
                    .attr('stroke-dasharray', '3,3')
                    .attr('opacity', 0.6);

                // ãƒãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ï¼ˆç¸å–ã‚Šä»˜ãï¼‰
                node.append('text')
                    .attr('class', 'node-text')
                    .attr('fill', 'black')
                    .attr('font-size', d => this.fontSize[d.level])
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .attr('stroke', '#ffffff')
                    .attr('stroke-width', '4px')
                    .attr('paint-order', 'stroke')
                    .attr('font-weight', d => {
                        // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ³ãƒˆã‚¦ã‚§ã‚¤ãƒˆã‚’èª¿æ•´
                        if (d.level === 0) return '800';  // ãƒ«ãƒ¼ãƒˆ
                        if (d.level === 1) return '700';  // ç¬¬1éšå±¤
                        if (d.level === 2) return '600';  // ç¬¬2éšå±¤
                        if (d.level === 3) return '500';  // ç¬¬3éšå±¤
                        return '400';  // ãã®ä»–
                    })
                    .text(d => d.name);
                
                // å‰é¢ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆé»’è‰²ï¼‰
                node.append('text')
                    .attr('class', 'node-text')
                    .attr('fill', '#000000')
                    .attr('font-size', d => this.fontSize[d.level])
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .attr('font-weight', d => {
                        // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ³ãƒˆã‚¦ã‚§ã‚¤ãƒˆã‚’èª¿æ•´
                        if (d.level === 0) return '800';  // ãƒ«ãƒ¼ãƒˆ
                        if (d.level === 1) return '700';  // ç¬¬1éšå±¤
                        if (d.level === 2) return '600';  // ç¬¬2éšå±¤
                        if (d.level === 3) return '500';  // ç¬¬3éšå±¤
                        return '400';  // ãã®ä»–
                    })
                    .text(d => d.name);

                // ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã¨ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                node.on('mouseenter', (event, d) => {
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
                    this.showTooltip(event, d);
                    // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºï¼ˆå›ºå®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰
                    const nodeElement = d3.select(event.currentTarget);
                    nodeElement.selectAll('.node-text').each(function() {
                        if (!d3.select(this).classed('fixed')) {
                            d3.select(this).classed('visible', true);
                        }
                    });
                })
                .on('mouseleave', (event, d) => {
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’éè¡¨ç¤º
                    this.hideTooltip();
                    // ãƒ†ã‚­ã‚¹ãƒˆã‚’éè¡¨ç¤ºï¼ˆå›ºå®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼‰
                    const nodeElement = d3.select(event.currentTarget);
                    nodeElement.selectAll('.node-text').each(function() {
                        if (!d3.select(this).classed('fixed')) {
                            d3.select(this).classed('visible', false);
                        }
                    });
                })
                .on('mousemove', (event) => this.updateTooltipPosition(event))
                .on('click', (event, d) => {
                    // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ†ã‚­ã‚¹ãƒˆã®å›ºå®šçŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
                    event.stopPropagation();
                    const nodeElement = d3.select(event.currentTarget);
                    nodeElement.selectAll('.node-text').each(function() {
                        const isFixed = d3.select(this).classed('fixed');
                        d3.select(this).classed('fixed', !isFixed);
                        if (!isFixed) {
                            d3.select(this).classed('visible', true);
                        }
                    });
                });

                // è«–æ–‡ãŒã‚ã‚‹æã«ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ 
                const paperIndicators = linkGroup.selectAll('.paper-indicator')
                    .data(this.links.filter(d => d.papers && d.papers.length > 0))
                    .enter().append('g')
                    .attr('class', 'paper-indicator-group');

                paperIndicators.append('circle')
                    .attr('r', 6)
                    .attr('fill', '#FFD700')  // ã‚´ãƒ¼ãƒ«ãƒ‰ã«çµ±ä¸€
                    .attr('class', 'paper-indicator')
                    .style('filter', 'drop-shadow(0 0 8px #FFD700)')
                    .on('mouseenter', (event, d) => {
                        const targetNode = typeof d.target === 'object' ? d.target : this.nodes.find(n => n.id === d.target);
                        if (targetNode) {
                            this.showPaperTooltip(event, d.papers, targetNode.name);
                        }
                    })
                    .on('mouseleave', () => this.hidePaperTooltip())
                    .on('mousemove', (event) => this.updatePaperTooltipPosition(event));

                paperIndicators.append('text')
                    .attr('fill', '#000000')
                    .attr('font-size', '10px')
                    .attr('font-weight', 'bold')
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'central')
                    .attr('pointer-events', 'none')
                    .attr('stroke', '#ffffff')
                    .attr('stroke-width', '2px')
                    .attr('paint-order', 'stroke')
                    .text(d => d.papers.length);

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚£ãƒƒã‚¯å‡¦ç†
                this.simulation.on('tick', () => {
                    // ãƒªãƒ³ã‚¯ã‚’æ›²ç·šã§æç”»ï¼ˆç¬¬3ãƒ¬ãƒ™ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã¯æ¸¦å·»ãã«ï¼‰
                    link.attr('d', d => {
                        const source = d.source;
                        const target = d.target;
                        if (!source || !target) return '';
                        
                        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒè«–æ–‡ãƒãƒ¼ãƒ‰ã®å ´åˆã€è«–æ–‡ãƒãƒ¼ãƒ‰ã‚’ä¸­å¿ƒã¨ã—ãŸæ¸¦å·»ãã‚’æã
                        if (target.paper && source.level >= 2) {
                            // è«–æ–‡ãƒãƒ¼ãƒ‰ãŒæ¸¦å·»ãã®ä¸­å¿ƒ
                            const centerX = target.x;
                            const centerY = target.y;
                            
                            // ã‚½ãƒ¼ã‚¹ã‹ã‚‰ä¸­å¿ƒã¸ã®æ–¹å‘ã‚’è¨ˆç®—
                            const dx = centerX - source.x;
                            const dy = centerY - source.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const angle = Math.atan2(dy, dx);
                            
                            // æ¸¦å·»ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                            const spirals = 2; // æ¸¦ã®å›è»¢æ•°ã‚’æ¸›ã‚‰ã—ã¦é‡ãªã‚Šã‚’é˜²ã
                            const maxRadius = Math.min(distance * 0.7, 80); // æœ€å¤§åŠå¾„ã‚’åˆ¶é™
                            const minRadius = 25; // æœ€å°åŠå¾„ï¼ˆè«–æ–‡ãƒãƒ¼ãƒ‰ã®å‘¨ã‚Šï¼‰
                            const points = [];
                            const steps = 60;
                            
                            // ã‚½ãƒ¼ã‚¹ã‹ã‚‰é–‹å§‹
                            points.push([source.x, source.y]);
                            
                            // ä¸­é–“ã®æ¥ç¶šç·š
                            const connectionLength = distance * 0.3;
                            for (let i = 1; i <= 10; i++) {
                                const t = i / 10;
                                const x = source.x + dx * t * 0.3;
                                const y = source.y + dy * t * 0.3;
                                points.push([x, y]);
                            }
                            
                            // å¤–å´ã‹ã‚‰å†…å´ã¸æ¸¦å·»ãã‚’æã
                            for (let i = 0; i <= steps; i++) {
                                const t = i / steps;
                                const spiralAngle = angle + spirals * 2 * Math.PI * t;
                                const r = maxRadius * (1 - t * 0.8) + minRadius * (t * 0.8);
                                
                                const x = centerX - r * Math.cos(spiralAngle);
                                const y = centerY - r * Math.sin(spiralAngle);
                                
                                points.push([x, y]);
                            }
                            
                            // ã‚¹ãƒ ãƒ¼ã‚ºãªæ›²ç·šã‚’ç”Ÿæˆ
                            const line = d3.line().curve(d3.curveBasis);
                            return line(points);
                        } else if (source.level === 1 && target.level === 2) {
                            // å¹¹ã‹ã‚‰æã¸ã®æ¥ç¶šã‚‚è£…é£¾çš„ã«
                            const dx = target.x - source.x;
                            const dy = target.y - source.y;
                            const controlOffset = 30 + Math.random() * 20;
                            const perpX = -dy / Math.sqrt(dx * dx + dy * dy) * controlOffset;
                            const perpY = dx / Math.sqrt(dx * dx + dy * dy) * controlOffset;
                            const side = Math.random() > 0.5 ? 1 : -1;
                            const controlX = source.x + dx * 0.5 + perpX * side;
                            const controlY = source.y + dy * 0.5 + perpY * side;
                            
                            return `M${source.x},${source.y} Q${controlX},${controlY} ${target.x},${target.y}`;
                        } else {
                            // é€šå¸¸ã®æ›²ç·š
                            const midY = (source.y + target.y) / 2;
                            const midX = (source.x + target.x) / 2;
                            const offsetX = (Math.random() - 0.5) * 20;
                            return `M${source.x},${source.y} C${source.x + offsetX},${midY} ${target.x - offsetX},${midY} ${target.x},${target.y}`;
                        }
                    });

                    // ãƒãƒ¼ãƒ‰ã®ä½ç½®ã‚’æ›´æ–°
                    node.attr('transform', d => `translate(${d.x}, ${d.y})`);

                    // è«–æ–‡ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®ä½ç½®ã‚’æ›´æ–°
                    paperIndicators.attr('transform', d => {
                        if (!d.source || !d.target) return '';
                        const midX = (d.source.x + d.target.x) / 2;
                        const midY = (d.source.y + d.target.y) / 2;
                        return `translate(${midX}, ${midY})`;
                    });
                });

                this.link = link;
                this.node = node;
                this.paperIndicators = paperIndicators;
            }

            dragstarted(event, d) {
                if (!event.active) this.simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            dragended(event, d) {
                if (!event.active) this.simulation.alphaTarget(0);
                // ãƒ¬ãƒ™ãƒ«0ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ã¯å›ºå®š
                if (d.level !== 0) {
                    d.fx = null;
                    d.fy = null;
                }
            }

            setupControls() {
                document.getElementById('restart-simulation').addEventListener('click', () => {
                    // å…¨ãƒãƒ¼ãƒ‰ã®å›ºå®šã‚’è§£é™¤ã—ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†é–‹
                    this.nodes.forEach(d => {
                        if (d.level !== 0) {
                            d.fx = null;
                            d.fy = null;
                        }
                    });
                    this.simulation.alpha(1).restart();
                });

                document.getElementById('freeze-simulation').addEventListener('click', () => {
                    // ç¾åœ¨ã®ä½ç½®ã§å…¨ãƒãƒ¼ãƒ‰ã‚’å›ºå®š
                    this.nodes.forEach(d => {
                        d.fx = d.x;
                        d.fy = d.y;
                    });
                });

                document.getElementById('reset-zoom').addEventListener('click', () => {
                    // ã‚ºãƒ¼ãƒ ã‚’åˆæœŸçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ
                    this.svg.transition()
                        .duration(750)
                        .call(this.zoom.transform, d3.zoomIdentity.scale(0.85));
                });
            }

            showTooltip(event, node) {
                let content = `<strong>${node.name}</strong><br>${node.description}`;
                if (node.paper) {
                    content = `<strong>${node.paper.title}</strong><br>${node.paper.journal} ${node.paper.year}<br>${node.paper.details}`;
                } else if (node.morePapers) {
                    content = `<strong>è¿½åŠ ã®è«–æ–‡</strong><br>`;
                    node.morePapers.forEach(paper => {
                        content += `ãƒ»${paper.title}<br>`;
                    });
                }
                this.tooltip.innerHTML = content;
                this.tooltip.classList.add('visible');
                this.updateTooltipPosition(event);
            }

            hideTooltip() {
                this.tooltip.classList.remove('visible');
            }

            updateTooltipPosition(event) {
                this.tooltip.style.left = `${event.clientX + 10}px`;
                this.tooltip.style.top = `${event.clientY - 10}px`;
            }

            showPaperTooltip(event, papers, categoryName) {
                let html = `<h4>ğŸ“š ${categoryName} ã®è«–æ–‡ä¸€è¦§ <span class="paper-count">${papers.length}</span></h4>`;
                
                papers.forEach(paper => {
                    html += `
                        <div class="paper-item">
                            <div class="paper-title">${paper.title}</div>
                            <div class="paper-meta">
                                ${paper.journal} ${paper.year} ${paper.details}
                            </div>
                        </div>
                    `;
                });
                
                this.paperTooltip.innerHTML = html;
                this.paperTooltip.classList.add('visible');
                this.updatePaperTooltipPosition(event);
            }

            hidePaperTooltip() {
                this.paperTooltip.classList.remove('visible');
            }

            updatePaperTooltipPosition(event) {
                const tooltipRect = this.paperTooltip.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                
                let left = event.clientX + 15;
                let top = event.clientY - 15;
                
                if (left + tooltipRect.width > windowWidth) {
                    left = event.clientX - tooltipRect.width - 15;
                }
                
                if (top + tooltipRect.height > windowHeight) {
                    top = windowHeight - tooltipRect.height - 10;
                }
                
                this.paperTooltip.style.left = `${left}px`;
                this.paperTooltip.style.top = `${top}px`;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ç³»çµ±æ¨¹ã‚’ä½œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            new TreeChart('tree-chart', treeData);
        });
    </script>
</body>
</html>
